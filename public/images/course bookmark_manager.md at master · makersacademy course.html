<!DOCTYPE html>
<!-- saved from url=(0071)https://github.com/makersacademy/course/blob/master/bookmark_manager.md -->
<html lang="en" class=""><head prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb# object: http://ogp.me/ns/object# article: http://ogp.me/ns/article# profile: http://ogp.me/ns/profile#"><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta http-equiv="Content-Language" content="en">
    
    
    <title>course/bookmark_manager.md at master · makersacademy/course</title>
    <link rel="search" type="application/opensearchdescription+xml" href="https://github.com/opensearch.xml" title="GitHub">
    <link rel="fluid-icon" href="https://github.com/fluidicon.png" title="GitHub">
    <link rel="apple-touch-icon" sizes="57x57" href="https://github.com/apple-touch-icon-114.png">
    <link rel="apple-touch-icon" sizes="114x114" href="https://github.com/apple-touch-icon-114.png">
    <link rel="apple-touch-icon" sizes="72x72" href="https://github.com/apple-touch-icon-144.png">
    <link rel="apple-touch-icon" sizes="144x144" href="https://github.com/apple-touch-icon-144.png">
    <meta property="fb:app_id" content="1401488693436528">

      <meta content="@github" name="twitter:site"><meta content="summary" name="twitter:card"><meta content="makersacademy/course" name="twitter:title"><meta content="course - Learn how to code in 12 weeks" name="twitter:description"><meta content="https://avatars0.githubusercontent.com/u/3636186?v=2&amp;s=400" name="twitter:image:src">
<meta content="GitHub" property="og:site_name"><meta content="object" property="og:type"><meta content="https://avatars0.githubusercontent.com/u/3636186?v=2&amp;s=400" property="og:image"><meta content="makersacademy/course" property="og:title"><meta content="https://github.com/makersacademy/course" property="og:url"><meta content="course - Learn how to code in 12 weeks" property="og:description">

      <meta name="browser-stats-url" content="/_stats">
    <link rel="assets" href="https://assets-cdn.github.com/">
    <link rel="conduit-xhr" href="https://ghconduit.com:25035/">
    <link rel="xhr-socket" href="https://github.com/_sockets">
    <meta name="pjax-timeout" content="1000">

    <meta name="msapplication-TileImage" content="/windows-tile.png">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="selected-link" value="repo_source" data-pjax-transient="">
      <meta name="google-analytics" content="UA-3769691-2">

    <meta content="collector.githubapp.com" name="octolytics-host"><meta content="collector-cdn.github.com" name="octolytics-script-host"><meta content="github" name="octolytics-app-id"><meta content="259D239A:76F8:1B38E317:54356D37" name="octolytics-dimension-request_id"><meta content="6886844" name="octolytics-actor-id"><meta content="snozza" name="octolytics-actor-login"><meta content="ee19b89ef171852205119a55ea803e45e6b73990d09edf0d39f369c34208a3e9" name="octolytics-actor-hash">
    <meta content="Rails, view, blob#show" name="analytics-event">

    
    
    <link rel="icon" type="image/x-icon" href="https://assets-cdn.github.com/favicon.ico">


    <meta content="authenticity_token" name="csrf-param">
<meta content="Yt8CbnCC1EyhXIIYLguQeQh39kdC/Fa2FEjUqjVq/zNq1+5tbK4DR5ZQ1T0kVGmmJFgnV5UYCA6XebSXk/0ziw==" name="csrf-token">

    <link href="./course bookmark_manager.md at master · makersacademy course_files/github-d545bcc0a6b5ca25793a78556ff5e8a330765ed8.css" media="all" rel="stylesheet" type="text/css">
    <link href="./course bookmark_manager.md at master · makersacademy course_files/github2-18620ba188b889c5c355ef902f56753da2c2d044.css" media="all" rel="stylesheet" type="text/css">
    


    <meta http-equiv="x-pjax-version" content="7afe07d9203de70c8d68739795f6f32c">

      
  <meta name="description" content="course - Learn how to code in 12 weeks">
  <meta name="go-import" content="github.com/makersacademy/course git https://github.com/makersacademy/course.git">

  <meta content="3636186" name="octolytics-dimension-user_id"><meta content="makersacademy" name="octolytics-dimension-user_login"><meta content="19606100" name="octolytics-dimension-repository_id"><meta content="makersacademy/course" name="octolytics-dimension-repository_nwo"><meta content="false" name="octolytics-dimension-repository_public"><meta content="false" name="octolytics-dimension-repository_is_fork"><meta content="19606100" name="octolytics-dimension-repository_network_root_id"><meta content="makersacademy/course" name="octolytics-dimension-repository_network_root_nwo">
  <link href="https://github.com/makersacademy/course/commits/master.atom?token=6886844__eyJzY29wZSI6IkF0b206L21ha2Vyc2FjYWRlbXkvY291cnNlL2NvbW1pdHMvbWFzdGVyLmF0b20iLCJleHBpcmVzIjoyOTkwNzE0MzEyfQ%3D%3D--0061db0a21febafe6b43a7b5025c71ca9432b0b8" rel="alternate" title="Recent Commits to course:master" type="application/atom+xml">

  <script type="text/javascript" async="" src="./course bookmark_manager.md at master · makersacademy course_files/api.js"></script></head>


  <body class="logged_in  env-production macintosh vis-private page-blob">
    <a href="https://github.com/makersacademy/course/blob/master/bookmark_manager.md#start-of-content" tabindex="1" class="accessibility-aid js-skip-to-content">Skip to content</a>
    <div class="wrapper">
      
      
      
      


      <div class="header header-logged-in true" role="banner">
  <div class="container clearfix">

    <a class="header-logo-invertocat" href="https://github.com/" data-hotkey="g d" aria-label="Homepage" ga-data-click="Header, go to dashboard, icon:logo">
  <span class="mega-octicon octicon-mark-github"></span>
</a>


      <div class="site-search repo-scope js-site-search" role="search">
          <form accept-charset="UTF-8" action="https://github.com/makersacademy/course/search" class="js-site-search-form" data-global-search-url="/search" data-repo-search-url="/makersacademy/course/search" method="get"><div style="margin:0;padding:0;display:inline"><input name="utf8" type="hidden" value="✓"></div>
  <input type="text" class="js-site-search-field is-clearable" data-hotkey="s" name="q" placeholder="Search" data-global-scope-placeholder="Search GitHub" data-repo-scope-placeholder="Search" tabindex="1" autocapitalize="off">
  <div class="scope-badge">This repository</div>
</form>
      </div>
      <ul class="header-nav left" role="navigation">
        <li class="header-nav-item explore">
          <a class="header-nav-link" href="https://github.com/explore" data-ga-click="Header, go to explore, text:explore">Explore</a>
        </li>
          <li class="header-nav-item">
            <a class="header-nav-link" href="https://gist.github.com/" data-ga-click="Header, go to gist, text:gist">Gist</a>
          </li>
          <li class="header-nav-item">
            <a class="header-nav-link" href="https://github.com/blog" data-ga-click="Header, go to blog, text:blog">Blog</a>
          </li>
        <li class="header-nav-item">
          <a class="header-nav-link" href="https://help.github.com/" data-ga-click="Header, go to help, text:help">Help</a>
        </li>
      </ul>

    
<ul class="header-nav user-nav right" id="user-links">
  <li class="header-nav-item dropdown js-menu-container">
    <a class="header-nav-link name" href="https://github.com/snozza" data-ga-click="Header, go to profile, text:username">
      <img alt="Andrew Snead" class="avatar" data-user="6886844" height="20" src="./course bookmark_manager.md at master · makersacademy course_files/6886844" width="20">
      <span class="css-truncate">
        <span class="css-truncate-target">snozza</span>
      </span>
    </a>
  </li>

  <li class="header-nav-item dropdown js-menu-container">
    <a class="header-nav-link js-menu-target tooltipped tooltipped-s" href="https://github.com/makersacademy/course/blob/master/bookmark_manager.md#" aria-label="Create new..." data-ga-click="Header, create new, icon:add">
      <span class="octicon octicon-plus"></span>
      <span class="dropdown-caret"></span>
    </a>

    <div class="dropdown-menu-content js-menu-content">
      
<ul class="dropdown-menu">
  <li>
    <a href="https://github.com/new"><span class="octicon octicon-repo"></span> New repository</a>
  </li>
  <li>
    <a href="https://github.com/organizations/new"><span class="octicon octicon-organization"></span> New organization</a>
  </li>


    <li class="dropdown-divider"></li>
    <li class="dropdown-header">
      <span title="makersacademy/course">This repository</span>
    </li>
      <li>
        <a href="https://github.com/makersacademy/course/issues/new"><span class="octicon octicon-issue-opened"></span> New issue</a>
      </li>
</ul>

    </div>
  </li>

  <li class="header-nav-item">
        <a href="https://github.com/notifications" aria-label="You have unread notifications" class="header-nav-link notification-indicator tooltipped tooltipped-s" data-ga-click="Header, go to notifications, icon:unread" data-hotkey="g n">
        <span class="mail-status unread"></span>
        <span class="octicon octicon-inbox"></span>
</a>
  </li>

  <li class="header-nav-item">
    <a class="header-nav-link tooltipped tooltipped-s" href="https://github.com/settings/profile" id="account_settings" aria-label="Settings" data-ga-click="Header, go to settings, icon:settings">
      <span class="octicon octicon-gear"></span>
    </a>
  </li>

  <li class="header-nav-item">
    <form accept-charset="UTF-8" action="https://github.com/logout" class="logout-form" method="post"><div style="margin:0;padding:0;display:inline"><input name="utf8" type="hidden" value="✓"><input name="authenticity_token" type="hidden" value="cnsinkmn74s9oJ3sGEDZlFUYuiOdWdyjQk5I+cROxEywV/fhPOjuQAYvPVo4Ii3KueClXvae+tUti3HdqaDAXQ=="></div>
      <button class="header-nav-link sign-out-button tooltipped tooltipped-s" aria-label="Sign out" data-ga-click="Header, sign out, icon:logout">
        <span class="octicon octicon-sign-out"></span>
      </button>
</form>  </li>

</ul>


    
  </div>
</div>

      

        


      <div id="start-of-content" class="accessibility-aid"></div>
          <div class="site" itemscope="" itemtype="http://schema.org/WebPage">
    <div id="js-flash-container">
      
    </div>
    <div class="pagehead repohead instapaper_ignore readability-menu">
      <div class="container">
        
<ul class="pagehead-actions">

    <li class="subscription">
      <form accept-charset="UTF-8" action="https://github.com/notifications/subscribe" class="js-social-container" data-autosubmit="true" data-remote="true" method="post"><div style="margin:0;padding:0;display:inline"><input name="utf8" type="hidden" value="✓"><input name="authenticity_token" type="hidden" value="Hxq6szsY/x131c3twoEseBxGYVI0iYqs2bEN+zrG1/LO2I8nS6z6zWr/IoYOUfluGCZo70MD8wOSItwGINjZqg=="></div>  <input id="repository_id" name="repository_id" type="hidden" value="19606100">

    <div class="select-menu js-menu-container js-select-menu">
      <a class="social-count js-social-count" href="https://github.com/makersacademy/course/watchers">
        22
      </a>
      <a href="https://github.com/makersacademy/course/subscription" class="minibutton select-menu-button with-count js-menu-target" role="button" tabindex="0" aria-haspopup="true">
        <span class="js-select-button">
          <span class="octicon octicon-eye"></span>
          Watch
        </span>
      </a>

      <div class="select-menu-modal-holder">
        <div class="select-menu-modal subscription-menu-modal js-menu-content" aria-hidden="true">
          <div class="select-menu-header">
            <span class="select-menu-title">Notifications</span>
            <span class="octicon octicon-x js-menu-close" role="button" aria-label="Close"></span>
          </div> <!-- /.select-menu-header -->

          <div class="select-menu-list js-navigation-container" role="menu">

            <div class="select-menu-item js-navigation-item selected" role="menuitem" tabindex="0">
              <span class="select-menu-item-icon octicon octicon-check"></span>
              <div class="select-menu-item-text">
                <input checked="checked" id="do_included" name="do" type="radio" value="included">
                <h4>Not watching</h4>
                <span class="description">Be notified when participating or @mentioned.</span>
                <span class="js-select-button-text hidden-select-button-text">
                  <span class="octicon octicon-eye"></span>
                  Watch
                </span>
              </div>
            </div> <!-- /.select-menu-item -->

            <div class="select-menu-item js-navigation-item " role="menuitem" tabindex="0">
              <span class="select-menu-item-icon octicon octicon octicon-check"></span>
              <div class="select-menu-item-text">
                <input id="do_subscribed" name="do" type="radio" value="subscribed">
                <h4>Watching</h4>
                <span class="description">Be notified of all conversations.</span>
                <span class="js-select-button-text hidden-select-button-text">
                  <span class="octicon octicon-eye"></span>
                  Unwatch
                </span>
              </div>
            </div> <!-- /.select-menu-item -->

            <div class="select-menu-item js-navigation-item " role="menuitem" tabindex="0">
              <span class="select-menu-item-icon octicon octicon-check"></span>
              <div class="select-menu-item-text">
                <input id="do_ignore" name="do" type="radio" value="ignore">
                <h4>Ignoring</h4>
                <span class="description">Never be notified.</span>
                <span class="js-select-button-text hidden-select-button-text">
                  <span class="octicon octicon-mute"></span>
                  Stop ignoring
                </span>
              </div>
            </div> <!-- /.select-menu-item -->

          </div> <!-- /.select-menu-list -->

        </div> <!-- /.select-menu-modal -->
      </div> <!-- /.select-menu-modal-holder -->
    </div> <!-- /.select-menu -->

</form>
    </li>

  <li>
    
  <div class="js-toggler-container js-social-container starring-container ">

    <form accept-charset="UTF-8" action="https://github.com/makersacademy/course/unstar" class="js-toggler-form starred js-unstar-button" data-remote="true" method="post"><div style="margin:0;padding:0;display:inline"><input name="utf8" type="hidden" value="✓"><input name="authenticity_token" type="hidden" value="33tqfXee+DzxiWIwe/2yiRbWXMH7+KgxOfw4GbAF4kC2OJ5kuy3Aln9TPB6lnreeMC3o8LF3BXVggLVV2H+B2Q=="></div>
      <button class="minibutton with-count js-toggler-target star-button" aria-label="Unstar this repository" title="Unstar makersacademy/course">
        <span class="octicon octicon-star"></span>
        Unstar
      </button>
        <a class="social-count js-social-count" href="https://github.com/makersacademy/course/stargazers">
          13
        </a>
</form>
    <form accept-charset="UTF-8" action="https://github.com/makersacademy/course/star" class="js-toggler-form unstarred js-star-button" data-remote="true" method="post"><div style="margin:0;padding:0;display:inline"><input name="utf8" type="hidden" value="✓"><input name="authenticity_token" type="hidden" value="mdpKYRBIbQDRDpK4nrxBctSO4DAyGegma8sPAhhk2xYasmgwIvqsvdh4TzsLn28iYgVNwlUDda8VP/pfAUIfng=="></div>
      <button class="minibutton with-count js-toggler-target star-button" aria-label="Star this repository" title="Star makersacademy/course">
        <span class="octicon octicon-star"></span>
        Star
      </button>
        <a class="social-count js-social-count" href="https://github.com/makersacademy/course/stargazers">
          13
        </a>
</form>  </div>

  </li>


        <li>
          <a href="https://github.com/makersacademy/course/fork" class="minibutton with-count js-toggler-target fork-button tooltipped-n" title="Fork your own copy of makersacademy/course to your account" aria-label="Fork your own copy of makersacademy/course to your account" rel="facebox nofollow">
            <span class="octicon octicon-repo-forked"></span>
            Fork
          </a>
          <a href="https://github.com/makersacademy/course/network" class="social-count">25</a>
        </li>

</ul>

        <h1 itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb" class="entry-title private">
          <span class="mega-octicon octicon-lock"></span>
          <span class="author"><a href="https://github.com/makersacademy" class="url fn" itemprop="url" rel="author"><span itemprop="title">makersacademy</span></a></span><!--
       --><span class="path-divider">/</span><!--
       --><strong><a href="https://github.com/makersacademy/course" class="js-current-repository js-repo-home-link">course</a></strong>
            <span class="repo-private-label">private</span>

          <span class="page-context-loader">
            <img alt="" height="16" src="./course bookmark_manager.md at master · makersacademy course_files/octocat-spinner-32.gif" width="16">
          </span>

        </h1>
      </div><!-- /.container -->
    </div><!-- /.repohead -->

    <div class="container">
      <div class="repository-with-sidebar repo-container new-discussion-timeline">
        <div class="repository-sidebar clearfix">
            
<div class="sunken-menu vertical-right repo-nav js-repo-nav js-repository-container-pjax js-octicon-loaders" role="navigation" data-issue-count-url="/makersacademy/course/issues/counts">
  <div class="sunken-menu-contents">
    <ul class="sunken-menu-group">
      <li class="tooltipped tooltipped-w" aria-label="Code">
        <a href="https://github.com/makersacademy/course" aria-label="Code" class="selected js-selected-navigation-item sunken-menu-item" data-hotkey="g c" data-pjax="true" data-selected-links="repo_source repo_downloads repo_commits repo_releases repo_tags repo_branches /makersacademy/course">
          <span class="octicon octicon-code"></span> <span class="full-word">Code</span>
          <img alt="" class="mini-loader" height="16" src="./course bookmark_manager.md at master · makersacademy course_files/octocat-spinner-32.gif" width="16">
</a>      </li>

        <li class="tooltipped tooltipped-w" aria-label="Issues">
          <a href="https://github.com/makersacademy/course/issues" aria-label="Issues" class="js-selected-navigation-item sunken-menu-item js-disable-pjax" data-hotkey="g i" data-selected-links="repo_issues repo_labels repo_milestones /makersacademy/course/issues">
            <span class="octicon octicon-issue-opened"></span> <span class="full-word">Issues</span>
            <span class="js-issue-replace-counter"></span>
            <img alt="" class="mini-loader" height="16" src="./course bookmark_manager.md at master · makersacademy course_files/octocat-spinner-32.gif" width="16">
</a>        </li>

      <li class="tooltipped tooltipped-w" aria-label="Pull Requests">
        <a href="https://github.com/makersacademy/course/pulls" aria-label="Pull Requests" class="js-selected-navigation-item sunken-menu-item js-disable-pjax" data-hotkey="g p" data-selected-links="repo_pulls /makersacademy/course/pulls">
            <span class="octicon octicon-git-pull-request"></span> <span class="full-word">Pull Requests</span>
            <span class="js-pull-replace-counter"></span>
            <img alt="" class="mini-loader" height="16" src="./course bookmark_manager.md at master · makersacademy course_files/octocat-spinner-32.gif" width="16">
</a>      </li>


        <li class="tooltipped tooltipped-w" aria-label="Wiki">
          <a href="https://github.com/makersacademy/course/wiki" aria-label="Wiki" class="js-selected-navigation-item sunken-menu-item js-disable-pjax" data-hotkey="g w" data-selected-links="repo_wiki /makersacademy/course/wiki">
            <span class="octicon octicon-book"></span> <span class="full-word">Wiki</span>
            <img alt="" class="mini-loader" height="16" src="./course bookmark_manager.md at master · makersacademy course_files/octocat-spinner-32.gif" width="16">
</a>        </li>
    </ul>
    <div class="sunken-menu-separator"></div>
    <ul class="sunken-menu-group">

      <li class="tooltipped tooltipped-w" aria-label="Pulse">
        <a href="https://github.com/makersacademy/course/pulse/weekly" aria-label="Pulse" class="js-selected-navigation-item sunken-menu-item" data-pjax="true" data-selected-links="pulse /makersacademy/course/pulse/weekly">
          <span class="octicon octicon-pulse"></span> <span class="full-word">Pulse</span>
          <img alt="" class="mini-loader" height="16" src="./course bookmark_manager.md at master · makersacademy course_files/octocat-spinner-32.gif" width="16">
</a>      </li>

      <li class="tooltipped tooltipped-w" aria-label="Graphs">
        <a href="https://github.com/makersacademy/course/graphs" aria-label="Graphs" class="js-selected-navigation-item sunken-menu-item" data-pjax="true" data-selected-links="repo_graphs repo_contributors /makersacademy/course/graphs">
          <span class="octicon octicon-graph"></span> <span class="full-word">Graphs</span>
          <img alt="" class="mini-loader" height="16" src="./course bookmark_manager.md at master · makersacademy course_files/octocat-spinner-32.gif" width="16">
</a>      </li>
    </ul>


  </div>
</div>

              <div class="only-with-full-nav">
                
  
<div class="clone-url open" data-protocol-type="http" data-url="/users/set_protocol?protocol_selector=http&amp;protocol_type=clone">
  <h3><span class="text-emphasized">HTTPS</span> clone URL</h3>
  <div class="input-group">
    <input type="text" class="input-mini input-monospace js-url-field" value="https://github.com/makersacademy/course.git" readonly="readonly">
    <span class="input-group-button">
      <button aria-label="Copy to clipboard" class="js-zeroclipboard minibutton zeroclipboard-button" data-clipboard-text="https://github.com/makersacademy/course.git" data-copied-hint="Copied!" type="button"><span class="octicon octicon-clippy"></span></button>
    </span>
  </div>
</div>

  
<div class="clone-url " data-protocol-type="ssh" data-url="/users/set_protocol?protocol_selector=ssh&amp;protocol_type=clone">
  <h3><span class="text-emphasized">SSH</span> clone URL</h3>
  <div class="input-group">
    <input type="text" class="input-mini input-monospace js-url-field" value="git@github.com:makersacademy/course.git" readonly="readonly">
    <span class="input-group-button">
      <button aria-label="Copy to clipboard" class="js-zeroclipboard minibutton zeroclipboard-button" data-clipboard-text="git@github.com:makersacademy/course.git" data-copied-hint="Copied!" type="button"><span class="octicon octicon-clippy"></span></button>
    </span>
  </div>
</div>

  
<div class="clone-url " data-protocol-type="subversion" data-url="/users/set_protocol?protocol_selector=subversion&amp;protocol_type=clone">
  <h3><span class="text-emphasized">Subversion</span> checkout URL</h3>
  <div class="input-group">
    <input type="text" class="input-mini input-monospace js-url-field" value="https://github.com/makersacademy/course" readonly="readonly">
    <span class="input-group-button">
      <button aria-label="Copy to clipboard" class="js-zeroclipboard minibutton zeroclipboard-button" data-clipboard-text="https://github.com/makersacademy/course" data-copied-hint="Copied!" type="button"><span class="octicon octicon-clippy"></span></button>
    </span>
  </div>
</div>


<p class="clone-options">You can clone with
      <a href="https://github.com/makersacademy/course/blob/master/bookmark_manager.md#" class="js-clone-selector" data-protocol="http">HTTPS</a>,
      <a href="https://github.com/makersacademy/course/blob/master/bookmark_manager.md#" class="js-clone-selector" data-protocol="ssh">SSH</a>,
      or <a href="https://github.com/makersacademy/course/blob/master/bookmark_manager.md#" class="js-clone-selector" data-protocol="subversion">Subversion</a>.
  <a href="https://help.github.com/articles/which-remote-url-should-i-use" class="help tooltipped tooltipped-n" aria-label="Get help on which URL is right for you.">
    <span class="octicon octicon-question"></span>
  </a>
</p>

  <a href="http://mac.github.com/" data-url="github-mac://openRepo/https://github.com/makersacademy/course" class="minibutton sidebar-button js-conduit-rewrite-url" title="Save makersacademy/course to your computer and use it in GitHub Desktop." aria-label="Save makersacademy/course to your computer and use it in GitHub Desktop.">
    <span class="octicon octicon-device-desktop"></span>
    Clone in Desktop
  </a>


                <a href="https://github.com/makersacademy/course/archive/master.zip" class="minibutton sidebar-button" aria-label="Download the contents of makersacademy/course as a zip file" title="Download the contents of makersacademy/course as a zip file" rel="nofollow">
                  <span class="octicon octicon-cloud-download"></span>
                  Download ZIP
                </a>
              </div>
        </div><!-- /.repository-sidebar -->

        <div id="js-repo-pjax-container" class="repository-content context-loader-container" data-pjax-container="">
          

<a href="https://github.com/makersacademy/course/blob/4e3f5470569363adfdc81e0e408835d97f97d346/bookmark_manager.md" class="hidden js-permalink-shortcut" data-hotkey="y">Permalink</a>

<!-- blob contrib key: blob_contributors:v21:72cb85b15103b2f43bd3df3be9b2648d -->

<div class="file-navigation">
  
<div class="select-menu js-menu-container js-select-menu left">
  <span class="minibutton select-menu-button js-menu-target css-truncate" data-hotkey="w" data-master-branch="master" data-ref="master" title="master" role="button" aria-label="Switch branches or tags" tabindex="0" aria-haspopup="true">
    <span class="octicon octicon-git-branch"></span>
    <i>branch:</i>
    <span class="js-select-button css-truncate-target">master</span>
  </span>

  <div class="select-menu-modal-holder js-menu-content js-navigation-container" data-pjax="" aria-hidden="true">

    <div class="select-menu-modal">
      <div class="select-menu-header">
        <span class="select-menu-title">Switch branches/tags</span>
        <span class="octicon octicon-x js-menu-close" role="button" aria-label="Close"></span>
      </div> <!-- /.select-menu-header -->

      <div class="select-menu-filters">
        <div class="select-menu-text-filter">
          <input type="text" aria-label="Filter branches/tags" id="context-commitish-filter-field" class="js-filterable-field js-navigation-enable" placeholder="Filter branches/tags">
        </div>
        <div class="select-menu-tabs">
          <ul>
            <li class="select-menu-tab">
              <a href="https://github.com/makersacademy/course/blob/master/bookmark_manager.md#" data-tab-filter="branches" class="js-select-menu-tab">Branches</a>
            </li>
            <li class="select-menu-tab">
              <a href="https://github.com/makersacademy/course/blob/master/bookmark_manager.md#" data-tab-filter="tags" class="js-select-menu-tab">Tags</a>
            </li>
          </ul>
        </div><!-- /.select-menu-tabs -->
      </div><!-- /.select-menu-filters -->

      <div class="select-menu-list select-menu-tab-bucket js-select-menu-tab-bucket" data-tab-filter="branches">

        <div data-filterable-for="context-commitish-filter-field" data-filterable-type="substring">


            <div class="select-menu-item js-navigation-item ">
              <span class="select-menu-item-icon octicon octicon-check"></span>
              <a href="https://github.com/makersacademy/course/blob/develop/bookmark_manager.md" data-name="develop" data-skip-pjax="true" rel="nofollow" class="js-navigation-open select-menu-item-text css-truncate-target" title="develop">develop</a>
            </div> <!-- /.select-menu-item -->
            <div class="select-menu-item js-navigation-item selected">
              <span class="select-menu-item-icon octicon octicon-check"></span>
              <a href="./course bookmark_manager.md at master · makersacademy course_files/course bookmark_manager.md at master · makersacademy course.html" data-name="master" data-skip-pjax="true" rel="nofollow" class="js-navigation-open select-menu-item-text css-truncate-target" title="master">master</a>
            </div> <!-- /.select-menu-item -->
            <div class="select-menu-item js-navigation-item ">
              <span class="select-menu-item-icon octicon octicon-check"></span>
              <a href="https://github.com/makersacademy/course/blob/week7/bookmark_manager.md" data-name="week7" data-skip-pjax="true" rel="nofollow" class="js-navigation-open select-menu-item-text css-truncate-target" title="week7">week7</a>
            </div> <!-- /.select-menu-item -->
        </div>

          <div class="select-menu-no-results">Nothing to show</div>
      </div> <!-- /.select-menu-list -->

      <div class="select-menu-list select-menu-tab-bucket js-select-menu-tab-bucket" data-tab-filter="tags">
        <div data-filterable-for="context-commitish-filter-field" data-filterable-type="substring">


        </div>

        <div class="select-menu-no-results">Nothing to show</div>
      </div> <!-- /.select-menu-list -->

    </div> <!-- /.select-menu-modal -->
  </div> <!-- /.select-menu-modal-holder -->
</div> <!-- /.select-menu -->

  <div class="button-group right">
    <a href="https://github.com/makersacademy/course/find/master" class="js-show-file-finder minibutton empty-icon tooltipped tooltipped-s" data-pjax="" data-hotkey="t" aria-label="Quickly jump between files">
      <span class="octicon octicon-list-unordered"></span>
    </a>
    <button class="js-zeroclipboard minibutton zeroclipboard-button" data-clipboard-text="bookmark_manager.md" aria-label="Copy to clipboard" data-copied-hint="Copied!">
      <span class="octicon octicon-clippy"></span>
    </button>
  </div>

  <div class="breadcrumb">
    <span class="repo-root js-repo-root"><span itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb"><a href="https://github.com/makersacademy/course" class="" data-branch="master" data-direction="back" data-pjax="true" itemscope="url"><span itemprop="title">course</span></a></span></span><span class="separator"> / </span><strong class="final-path">bookmark_manager.md</strong>
  </div>
</div>


  <div class="commit file-history-tease">
    <div class="file-history-tease-header">
        <img alt="Enrique Comba Riepenhausen" class="avatar" data-user="55259" height="24" src="./course bookmark_manager.md at master · makersacademy course_files/55259" width="24">
        <span class="author"><a href="https://github.com/ecomba" rel="contributor">ecomba</a></span>
        <time datetime="2014-09-16T10:14:01Z" is="relative-time" title="Sep 16, 2014 11:14 AM GMT+01:00">23 days ago</time>
        <div class="commit-title">
            <a href="https://github.com/makersacademy/course/commit/15b76c2648f86676068abae821bb2845b07159ed" class="message" data-pjax="true" title="Mfalseerge branch &#39;master&#39; of github.com:makersacademy/course">Mfalseerge branch 'master' of github.com:makersacademy/course</a>
        </div>
    </div>

    <div class="participation">
      <p class="quickstat">
        <a href="https://github.com/makersacademy/course/blob/master/bookmark_manager.md#blob_contributors_box" rel="facebox">
          <strong>7</strong>
           contributors
        </a>
      </p>
          <a class="avatar-link tooltipped tooltipped-s" aria-label="ecomba" href="https://github.com/makersacademy/course/commits/master/bookmark_manager.md?author=ecomba"><img alt="Enrique Comba Riepenhausen" class="avatar" data-user="55259" height="20" src="./course bookmark_manager.md at master · makersacademy course_files/55259(1)" width="20"></a>
    <a class="avatar-link tooltipped tooltipped-s" aria-label="gypsydave5" href="https://github.com/makersacademy/course/commits/master/bookmark_manager.md?author=gypsydave5"><img alt="David Wickes" class="avatar" data-user="5469544" height="20" src="./course bookmark_manager.md at master · makersacademy course_files/5469544" width="20"></a>
    <a class="avatar-link tooltipped tooltipped-s" aria-label="henryaj" href="https://github.com/makersacademy/course/commits/master/bookmark_manager.md?author=henryaj"><img alt="Henry Stanley" class="avatar" data-user="1193856" height="20" src="./course bookmark_manager.md at master · makersacademy course_files/1193856" width="20"></a>
    <a class="avatar-link tooltipped tooltipped-s" aria-label="Jrmcneil" href="https://github.com/makersacademy/course/commits/master/bookmark_manager.md?author=Jrmcneil"><img alt="James McNeil" class="avatar" data-user="8350153" height="20" src="./course bookmark_manager.md at master · makersacademy course_files/8350153" width="20"></a>
    <a class="avatar-link tooltipped tooltipped-s" aria-label="roidriscoll" href="https://github.com/makersacademy/course/commits/master/bookmark_manager.md?author=roidriscoll"><img alt="Roi Driscoll" class="avatar" data-user="2243253" height="20" src="./course bookmark_manager.md at master · makersacademy course_files/2243253" width="20"></a>
    <a class="avatar-link tooltipped tooltipped-s" aria-label="tansaku" href="https://github.com/makersacademy/course/commits/master/bookmark_manager.md?author=tansaku"><img alt="Sam Joseph" class="avatar" data-user="30216" height="20" src="./course bookmark_manager.md at master · makersacademy course_files/30216" width="20"></a>
    <a class="avatar-link tooltipped tooltipped-s" aria-label="BobRazoswki" href="https://github.com/makersacademy/course/commits/master/bookmark_manager.md?author=BobRazoswki"><img alt="BobRazoswki" class="avatar" data-user="7914154" height="20" src="./course bookmark_manager.md at master · makersacademy course_files/7914154" width="20"></a>


    </div>
    <div id="blob_contributors_box" style="display:none">
      <h2 class="facebox-header">Users who have contributed to this file</h2>
      <ul class="facebox-user-list">
          <li class="facebox-user-list-item">
            <img alt="Enrique Comba Riepenhausen" data-user="55259" height="24" src="./course bookmark_manager.md at master · makersacademy course_files/55259" width="24">
            <a href="https://github.com/ecomba">ecomba</a>
          </li>
          <li class="facebox-user-list-item">
            <img alt="David Wickes" data-user="5469544" height="24" src="./course bookmark_manager.md at master · makersacademy course_files/5469544(1)" width="24">
            <a href="https://github.com/gypsydave5">gypsydave5</a>
          </li>
          <li class="facebox-user-list-item">
            <img alt="Henry Stanley" data-user="1193856" height="24" src="./course bookmark_manager.md at master · makersacademy course_files/1193856(1)" width="24">
            <a href="https://github.com/henryaj">henryaj</a>
          </li>
          <li class="facebox-user-list-item">
            <img alt="James McNeil" data-user="8350153" height="24" src="./course bookmark_manager.md at master · makersacademy course_files/8350153(1)" width="24">
            <a href="https://github.com/Jrmcneil">Jrmcneil</a>
          </li>
          <li class="facebox-user-list-item">
            <img alt="Roi Driscoll" data-user="2243253" height="24" src="./course bookmark_manager.md at master · makersacademy course_files/2243253(1)" width="24">
            <a href="https://github.com/roidriscoll">roidriscoll</a>
          </li>
          <li class="facebox-user-list-item">
            <img alt="Sam Joseph" data-user="30216" height="24" src="./course bookmark_manager.md at master · makersacademy course_files/30216(1)" width="24">
            <a href="https://github.com/tansaku">tansaku</a>
          </li>
          <li class="facebox-user-list-item">
            <img alt="BobRazoswki" data-user="7914154" height="24" src="./course bookmark_manager.md at master · makersacademy course_files/7914154(1)" width="24">
            <a href="https://github.com/BobRazoswki">BobRazoswki</a>
          </li>
      </ul>
    </div>
  </div>

<div class="file-box">
  <div class="file">
    <div class="meta clearfix">
      <div class="info file-name">
          <span>1786 lines (1301 sloc)</span>
          <span class="meta-divider"></span>
        <span>72.423 kb</span>
      </div>
      <div class="actions">
        <div class="button-group">
          <a href="https://github.com/makersacademy/course/raw/master/bookmark_manager.md" class="minibutton " id="raw-url">Raw</a>
            <a href="https://github.com/makersacademy/course/blame/master/bookmark_manager.md" class="minibutton js-update-url-with-hash">Blame</a>
          <a href="https://github.com/makersacademy/course/commits/master/bookmark_manager.md" class="minibutton " rel="nofollow">History</a>
        </div><!-- /.button-group -->

          <a class="octicon-button tooltipped tooltipped-nw js-conduit-openfile-check disabled" href="http://mac.github.com/" data-url="github-mac://openRepo/https://github.com/makersacademy/course?branch=master&amp;filepath=bookmark_manager.md" aria-label="Your version of GitHub for Mac is too old to open this file. Try checking for updates." data-failed-title="Your version of GitHub for Mac is too old to open this file. Try checking for updates.">
              <span class="octicon octicon-device-desktop"></span>
          </a>

              <a class="octicon-button tooltipped tooltipped-n js-update-url-with-hash" aria-label="Clicking this button will fork this project so you can edit the file" href="https://github.com/makersacademy/course/edit/master/bookmark_manager.md" data-method="post" rel="nofollow"><span class="octicon octicon-pencil"></span></a>

            <a class="octicon-button danger tooltipped tooltipped-s" href="https://github.com/makersacademy/course/delete/master/bookmark_manager.md" aria-label="Fork this project and delete file" data-method="post" data-test-id="delete-blob-file" rel="nofollow">
          <span class="octicon octicon-trashcan"></span>
        </a>
      </div><!-- /.actions -->
    </div>
      <div id="readme" class="blob instapaper_body">
    <article class="markdown-body entry-content" itemprop="mainContentOfPage"><h1>
<a name="user-content-bookmark-manager" class="anchor" href="https://github.com/makersacademy/course/blob/master/bookmark_manager.md#bookmark-manager" aria-hidden="true"><span class="octicon octicon-link"></span></a>Bookmark manager</h1>

<h3>
<a name="user-content-completion-time-3-4-days" class="anchor" href="https://github.com/makersacademy/course/blob/master/bookmark_manager.md#completion-time-3-4-days" aria-hidden="true"><span class="octicon octicon-link"></span></a>Completion time 3-4 days</h3>

<p>This week's project is a bookmark manager. The goal is to expose you to the following aspects of web development, in addition to what we've studied before:</p>

<ul class="task-list">
<li>Integration testing: Capybara (Monday)</li>
<li>Relational databases (Tuesday and Wednesday)</li>
<li>Security considerations (Thursday)</li>
</ul><p>In addition to the technologies mentioned above, this project is going to be more challenging on the front-end. You shouldn't need more than we've covered in the previous weeks but you should expect to spend more time on the front-end, compared to BattleShip– web version. Of course, we'll also continue to be using the technologies we're familiar with: Sinatra, RSpec, etc.</p>

<h2>
<a name="user-content-high-level-specification" class="anchor" href="https://github.com/makersacademy/course/blob/master/bookmark_manager.md#high-level-specification" aria-hidden="true"><span class="octicon octicon-link"></span></a>High-level specification</h2>

<p>We are going to build a bookmark manager, similar to pineapple.io or delicious.com in spirit. A bookmark manager is a good use case for exploring how relational databases work.</p>

<p>A bookmark manager is a website to maintain a collection of links, organised by tags. You can use it to save a webpage you found useful. You can add tags to the webpages you saved to find them later. You can browse links other users have added.</p>

<p>The website will have the following options:</p>

<ul class="task-list">
<li>Show a list of links from the database</li>
<li>Add new links</li>
<li>Add tags to the links</li>
<li>Filter links by a tag</li>
</ul><p>This is the basic view of the website. This tutorial will discuss how to build it, step by step. At the end of the section there are multiple exercises challenging you to extend the functionality of this website.</p>

<p><a href="./course bookmark_manager.md at master · makersacademy course_files/68747470733a2f2f646368746d36723437316d75692e636c6f756466726f6e742e6e65742f6861636b7061642e636f6d5f6a75624d786442726a6e695f702e35323536375f313338303237393037333135395f53637265656e25323053686f74253230323031332d30392d3237253230617425323031312e30362e31322e706" target="_blank"><img src="./course bookmark_manager.md at master · makersacademy course_files/68747470733a2f2f646368746d36723437316d75692e636c6f756466726f6e742e6e65742f6861636b7061642e636f6d5f6a75624d786442726a6e695f702e35323536375f313338303237393037333135395f53637265656e25323053686f74253230323031332d30392d3237253230617425323031312e30362e31322e706" alt="alt text" title="Bookmark Manager" data-canonical-src="https://dchtm6r471mui.cloudfront.net/hackpad.com_jubMxdBrjni_p.52567_1380279073159_Screen%20Shot%202013-09-27%20at%2011.06.12.png" style="max-width:100%;"></a></p>

<h2>
<a name="user-content-first-steps" class="anchor" href="https://github.com/makersacademy/course/blob/master/bookmark_manager.md#first-steps" aria-hidden="true"><span class="octicon octicon-link"></span></a>First Steps</h2>

<p>As you'd do with every new project, create a new repository on Github. Create an empty Sinatra application with a Gemfile and config.ru.</p>

<h2>
<a name="user-content-outline" class="anchor" href="https://github.com/makersacademy/course/blob/master/bookmark_manager.md#outline" aria-hidden="true"><span class="octicon octicon-link"></span></a>Outline</h2>

<p>To prevent this pad from getting very large, let's break it down into sections.</p>

<h2>
<a name="user-content-bookmark-manager--adding-the-database" class="anchor" href="https://github.com/makersacademy/course/blob/master/bookmark_manager.md#bookmark-manager--adding-the-database" aria-hidden="true"><span class="octicon octicon-link"></span></a>Bookmark manager – Adding the database</h2>

<p>In this project, we'll need to store the data in a database. Before we add any functionality, let's add a relational database to this project.</p>

<p>First you will have to install postgresql (unless you have installed it already). First install PostgreSQL. Postgres is a widely used open source relational database engine.</p>

<p>There are two ways of doing this. Downloading the app (2) will, sometimes, leave you with a non-working postgresql installation. We recommend using option 1.</p>

<p>1) Install it through Homebrew with "brew install postgresql" (after it has installed postgres follow the on screen instructions).</p>

<p>2)  In your terminal run</p>

<p><code>brew install postgresql</code></p>

<p>After homebrew has downloaded the software it will show you some installation instructions, follow them! Ok, they might not be that readable ;)</p>

<p>Make sure you run these commands after installing postgresql with homebrew:</p>

<p><code>ln -sfv /usr/local/opt/postgresql/*.plist ~/Library/LaunchAgents</code><br><code>launchctl load ~/Library/LaunchAgents/homebrew.mxcl.postgresql.plist</code></p>

<p>You can check your installation by running</p>

<p><code>psql</code></p>

<p>At first it can happen that you don't have a database named after your username (you will see a messags along the lines 'unknown database "ecomba"). Let's create that database for you so that you can loging without having to specify the database:</p>

<p><code>psql postgres</code></p>

<p><code>postgres# create database "ecomba";</code></p>

<p><code>CREATE DATABASE</code></p>

<p><code>postgres# \q</code></p>

<p>From now on you will be able to log in to postgresql without having to specify the database you want to log into.</p>

<p>To talk to the database, we'll need the datamapper gem. It's an ORM (Object-relational mapper), which means that it's providing a convenient way to interact with our data using classes and objects instead of working with database tables directly.</p>

<p>Another advantage of datamapper is that is can be used with a variety of database engines, not only postgres. This implies that we'll need to install an adapter to work with postgres, apart from the datamapper itself. Add these gems to your Gemfile:</p>

<div class="highlight highlight-ruby"><pre><span class="n">gem</span> <span class="s1">'data_mapper'</span>
<span class="n">gem</span> <span class="s1">'dm-postgres-adapter'</span>
</pre></div>

<p>Don't forget to run "bundle install" every time you update your Gemfile.</p>

<p>Then let's create our first model. Since our bookmark manager is going to manage collections of links, it'll certainly need a table to store them. So, create a model in lib/link.rb.</p>

<div class="highlight highlight-ruby"><pre><span class="c1"># This class corresponds to a table in the database</span>
<span class="c1"># We can use it to manipulate the data</span>
<span class="k">class</span> <span class="nc">Link</span>

  <span class="c1"># this makes the instances of this class Datamapper resources</span>
  <span class="kp">include</span> <span class="no">DataMapper</span><span class="o">::</span><span class="no">Resource</span>

  <span class="c1"># This block describes what resources our model will have</span>
  <span class="n">property</span> <span class="ss">:id</span><span class="p">,</span>     <span class="no">Serial</span> <span class="c1"># Serial means that it will be auto-incremented for every record</span>
  <span class="n">property</span> <span class="ss">:title</span><span class="p">,</span>  <span class="nb">String</span>
  <span class="n">property</span> <span class="ss">:url</span><span class="p">,</span>    <span class="nb">String</span>

<span class="k">end</span>
</pre></div>

<p>This file describes the relationship between the table in the database (they don't exist yet) and this Ruby class. We'll see how it can be used in a minute.</p>

<p>Then, add this code to server.rb.</p>

<div class="highlight highlight-ruby"><pre><span class="n">env</span> <span class="o">=</span> <span class="no">ENV</span><span class="o">[</span><span class="s2">"RACK_ENV"</span><span class="o">]</span> <span class="o">||</span> <span class="s2">"development"</span>
<span class="c1"># we're telling datamapper to use a postgres database on localhost. The name will be "bookmark_manager_test" or "bookmark_manager_development" depending on the environment</span>
<span class="no">DataMapper</span><span class="o">.</span><span class="n">setup</span><span class="p">(</span><span class="ss">:default</span><span class="p">,</span> <span class="s2">"postgres://localhost/bookmark_manager_</span><span class="si">#{</span><span class="n">env</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>

<span class="nb">require</span> <span class="s1">'./lib/link'</span> <span class="c1"># this needs to be done after datamapper is initialised</span>

<span class="c1"># After declaring your models, you should finalise them</span>
<span class="no">DataMapper</span><span class="o">.</span><span class="n">finalize</span>

<span class="c1"># However, the database tables don't exist yet. Let's tell datamapper to create them</span>
<span class="no">DataMapper</span><span class="o">.</span><span class="n">auto_upgrade!</span>
</pre></div>

<p>So, we begin by telling datamapper where our database is going to be. The second argument to setup() is called a connection string. It has the following format.</p>

<p><code>dbtype://user:password@hostname:port/databasename</code></p>

<p>By default Postgres.app is configured to accept connections from a logged in user without the password, so we omit them. Since postgres is running on the default port 5432, it doesn't have to be specified either.</p>

<p>After we require our models, datamapper will know what data schema we have in our project (because we include DataMapper::Resource in every model). After the models are finalised (checked for consistency), we can ask datamapper to create the tables.</p>

<p>However, datamapper will not create the database for us. We need to do it ourselves.</p>

<p>In the terminal run psql to connect to your database server.</p>

<p>Psql is a text-based interface to talk to the database, much like irb is used to run Ruby code. Let's create both databases we need using SQL commands.</p>

<p><a href="./course bookmark_manager.md at master · makersacademy course_files/68747470733a2f2f646368746d36723437316d75692e636c6f756466726f6e742e6e65742f6861636b7061642e636f6d5f6a75624d786442726a6e695f702e35323536375f313337393933373836373639315f53637265656e25323053686f74253230323031332d30392d3233253230617425323031322e34342e31342e706" target="_blank"><img src="./course bookmark_manager.md at master · makersacademy course_files/68747470733a2f2f646368746d36723437316d75692e636c6f756466726f6e742e6e65742f6861636b7061642e636f6d5f6a75624d786442726a6e695f702e35323536375f313337393933373836373639315f53637265656e25323053686f74253230323031332d30392d3233253230617425323031322e34342e31342e706" alt="alt text" title="terminal" data-canonical-src="https://dchtm6r471mui.cloudfront.net/hackpad.com_jubMxdBrjni_p.52567_1379937867691_Screen%20Shot%202013-09-23%20at%2012.44.14.png" style="max-width:100%;"></a></p>

<p>Finally, type
<code>\q</code>
to exit psql.</p>

<p>Now we have everything we need to use datamapper in our code. Let's see how we could do it by writin an rspec test.</p>

<p>RSpec demonstration</p>

<p>First, add rspec to the Gemfile.</p>

<div class="highlight highlight-ruby"><pre><span class="n">group</span> <span class="ss">:development</span><span class="p">,</span> <span class="ss">:test</span> <span class="k">do</span>
  <span class="n">gem</span> <span class="s2">"rspec"</span>
 <span class="k">end</span>
</pre></div>

<p>Then, init the rspec files:</p>

<div class="highlight highlight-ruby"><pre><span class="n">rspec</span> <span class="o">--</span><span class="n">init</span>
</pre></div>

<p>Add this on top of spec/spec_helper:</p>

<div class="highlight highlight-ruby"><pre><span class="c1"># Remember environment variables from week 1?</span>
<span class="no">ENV</span><span class="o">[</span><span class="s2">"RACK_ENV"</span><span class="o">]</span> <span class="o">=</span> <span class="s1">'test'</span> <span class="c1"># because we need to know what database to work with</span>

<span class="c1"># this needs to be after ENV["RACK_ENV"] = 'test'</span>
<span class="c1"># because the server needs to know</span>
<span class="c1"># what environment it's running it: test or development.</span>
<span class="c1"># The environment determines what database to use.</span>
<span class="nb">require</span> <span class="s1">'server'</span>
</pre></div>

<p>Finally, create the spec/link_spec.rb:</p>

<div class="highlight highlight-ruby"><pre><span class="nb">require</span> <span class="s1">'spec_helper'</span>

<span class="n">describe</span> <span class="no">Link</span> <span class="k">do</span>

  <span class="n">context</span> <span class="s2">"Demonstration of how datamapper works"</span> <span class="k">do</span>

    <span class="c1"># This is not a real test, it's simply a demo of how it works</span>
    <span class="n">it</span> <span class="s1">'should be created and then retrieved from the db'</span> <span class="k">do</span>
      <span class="c1"># In the beginning our database is empty, so there are no links</span>
      <span class="n">expect</span><span class="p">(</span><span class="no">Link</span><span class="o">.</span><span class="n">count</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">eq</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
      <span class="c1"># this creates it in the database, so it's stored on the disk</span>
      <span class="no">Link</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="ss">:title</span> <span class="o">=&gt;</span> <span class="s2">"Makers Academy"</span><span class="p">,</span>
                  <span class="ss">:url</span> <span class="o">=&gt;</span> <span class="s2">"http://www.makersacademy.com/"</span><span class="p">)</span>
      <span class="c1"># We ask the database how many links we have, it should be 1</span>
      <span class="n">expect</span><span class="p">(</span><span class="no">Link</span><span class="o">.</span><span class="n">count</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">eq</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
      <span class="c1"># Let's get the first (and only) link from the database</span>
      <span class="n">link</span> <span class="o">=</span> <span class="no">Link</span><span class="o">.</span><span class="n">first</span>
      <span class="c1"># Now it has all properties that it was saved with.</span>
      <span class="n">expect</span><span class="p">(</span><span class="n">link</span><span class="o">.</span><span class="n">url</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">eq</span><span class="p">(</span><span class="s2">"http://www.makersacademy.com/"</span><span class="p">)</span>
      <span class="n">expect</span><span class="p">(</span><span class="n">link</span><span class="o">.</span><span class="n">title</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">eq</span><span class="p">(</span><span class="s2">"Makers Academy"</span><span class="p">)</span>
      <span class="c1"># If we want to, we can destroy it</span>
      <span class="n">link</span><span class="o">.</span><span class="n">destroy</span>
      <span class="c1"># so now we have no links in the database</span>
      <span class="n">expect</span><span class="p">(</span><span class="no">Link</span><span class="o">.</span><span class="n">count</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">eq</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">end</span>

  <span class="k">end</span>

<span class="k">end</span>

</pre></div>

<p>Check that it all works by running the test (make sure you have required "data_mapper" in server.rb).</p>

<p><code>$ rspec</code>
Run options: include {:focus=&gt;true}</p>

<pre><code>All examples were filtered out; ignoring {:focus=&gt;true}
.

Finished in 0.00991 seconds
1 example, 0 failures

Randomized with seed 41436

</code></pre>

<p>Why two databases?</p>

<p>A web project usually has at least three environments: development, test and production. An environment is the "mode" the project is running in, determined by the set of the environment variables (the environment the shell variables are in and the environment the project is running in are two different concepts that share the same name).</p>

<p>The environment the project is running in determines the behaviour of the project. For example, if we have an e-commerce project, our payment processing would be different for the three environment:
in production (when real customers use it), all credit cards would be charged for real
in development (when writing code), we would use special "development" credit cards that behave like real ones, except that no money is actually spent
in test (when running automated tests), we wouldn't even connect to the card processing centre to not slow down the tests</p>

<p>Depending on the environment, we may do or not do certain things: send real emails in production but only pretend to do it in a test environment. Our code can print extensive debugging information in development but only show succinct error messages in production.</p>

<p>So, getting back to the databases: we don't want to use the same database in different environments. Imagine you have one million users registered on your website. You don't want to use the same database for development. When you launch the website locally you only want to have a database with a few users that you control manually. And when you run your tests, you want your database to be empty because every test assumes that there is nothing there that wasn't created explicitely. What happens if your test deletes all data from the database and you run in on a production or development database? You'd lose data. So, we really need to use one database per environment.</p>

<p>That is why we are checking what environment we're in, defaulting to development.</p>

<div class="highlight highlight-ruby"><pre><span class="n">env</span> <span class="o">=</span> <span class="no">ENV</span><span class="o">[</span><span class="s2">"RACK_ENV"</span><span class="o">]</span> <span class="o">||</span> <span class="s2">"development"</span>
</pre></div>

<p>And then we select the database based on the environment.</p>

<div class="highlight highlight-ruby"><pre><span class="no">DataMapper</span><span class="o">.</span><span class="n">setup</span><span class="p">(</span><span class="ss">:default</span><span class="p">,</span> <span class="s2">"postgres://localhost/bookmark_manager_</span><span class="si">#{</span><span class="n">env</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</pre></div>

<p>Finally, in our spec_helper we specify the environment, so that our tests were using the right database.</p>

<div class="highlight highlight-ruby"><pre><span class="no">ENV</span><span class="o">[</span><span class="s2">"RACK_ENV"</span><span class="o">]</span> <span class="o">=</span> <span class="s1">'test'</span>
</pre></div>

<p>Current state is on Github.
<a href="https://github.com/makersacademy/bookmark_manager/tree/24321e022f78f1275b77dcdff32e2df963d281f2">https://github.com/makersacademy/bookmark_manager/tree/24321e022f78f1275b77dcdff32e2df963d281f2</a></p>

<h2>
<a name="user-content-cleaning-the-database" class="anchor" href="https://github.com/makersacademy/course/blob/master/bookmark_manager.md#cleaning-the-database" aria-hidden="true"><span class="octicon octicon-link"></span></a>Cleaning the database</h2>

<p>When a test runs, it assumes that the database is empty. The test is not obliged to leave the database clean, though. We need to take care of this ourselves. Add the database_cleaner gem to the Gemfile and install it. Then, require it in the spec_helper and configure RSpec to use it.</p>

<div class="highlight highlight-ruby"><pre><span class="no">RSpec</span><span class="o">.</span><span class="n">configure</span> <span class="k">do</span> <span class="o">|</span><span class="n">config</span><span class="o">|</span>

  <span class="n">config</span><span class="o">.</span><span class="n">before</span><span class="p">(</span><span class="ss">:suite</span><span class="p">)</span> <span class="k">do</span>
    <span class="no">DatabaseCleaner</span><span class="o">.</span><span class="n">strategy</span> <span class="o">=</span> <span class="ss">:transaction</span>
    <span class="no">DatabaseCleaner</span><span class="o">.</span><span class="n">clean_with</span><span class="p">(</span><span class="ss">:truncation</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="n">config</span><span class="o">.</span><span class="n">before</span><span class="p">(</span><span class="ss">:each</span><span class="p">)</span> <span class="k">do</span>
    <span class="no">DatabaseCleaner</span><span class="o">.</span><span class="n">start</span>
  <span class="k">end</span>

  <span class="n">config</span><span class="o">.</span><span class="n">after</span><span class="p">(</span><span class="ss">:each</span><span class="p">)</span> <span class="k">do</span>
    <span class="no">DatabaseCleaner</span><span class="o">.</span><span class="n">clean</span>
  <span class="k">end</span>

<span class="k">end</span>
</pre></div>

<p>This will make sure that the database is cleared after every test run.</p>

<p>Current State on Github
<a href="https://github.com/makersacademy/bookmark_manager/tree/15f77fecce729e2a9225f3ac2d369e201f6ce142">https://github.com/makersacademy/bookmark_manager/tree/15f77fecce729e2a9225f3ac2d369e201f6ce142</a></p>

<h1>
<a name="user-content-bookmark-manager--managing-links-and-tags" class="anchor" href="https://github.com/makersacademy/course/blob/master/bookmark_manager.md#bookmark-manager--managing-links-and-tags" aria-hidden="true"><span class="octicon octicon-link"></span></a>Bookmark manager – Managing links and tags</h1>

<p>Browsing links</p>

<p>Let's write our first integration test using Capybara first. First, add capybara to your Gemfile and install it. Then, require and configure it in spec_helper as instructed on the capybara github page.</p>

<div class="highlight highlight-ruby"><pre><span class="nb">require</span> <span class="s1">'capybara/rspec'</span>

<span class="no">Capybara</span><span class="o">.</span><span class="n">app</span> <span class="o">=</span> <span class="no">Sinatra</span><span class="o">::</span><span class="no">Application</span><span class="o">.</span><span class="n">new</span>
</pre></div>

<p>Then, create spec/features folder where our integration tests will be. Create the first test (listing_all_links_spec.rb) that visits the homepage and checks that the link we put in the database is there.</p>

<div class="highlight highlight-ruby"><pre><span class="nb">require</span> <span class="s1">'spec_helper'</span>

<span class="n">feature</span> <span class="s2">"User browses the list of links"</span> <span class="k">do</span>

  <span class="n">before</span><span class="p">(</span><span class="ss">:each</span><span class="p">)</span> <span class="p">{</span>
    <span class="no">Link</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="ss">:url</span> <span class="o">=&gt;</span> <span class="s2">"http://www.makersacademy.com"</span><span class="p">,</span>
                <span class="ss">:title</span> <span class="o">=&gt;</span> <span class="s2">"Makers Academy"</span><span class="p">)</span>
  <span class="p">}</span>

  <span class="n">scenario</span> <span class="s2">"when opening the home page"</span> <span class="k">do</span>
    <span class="n">visit</span> <span class="s1">'/'</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">page</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">have_content</span><span class="p">(</span><span class="s2">"Makers Academy"</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>

<p>So, this test creates one link, goes to the homepage and expects to see it there (well, not exactly, it just looks for "Makers Academy" words somewhere on the page). If you run the test, it should fail.</p>

<pre><code>Failures:

  1) User browses the list of links when opening the home page
     Failure/Error: expect(page).to have_content("Makers Academy")
       expected to find text "Makers Academy" in "Welcome to the bookmark manager"
     # ./spec/features/listing_all_links_spec.rb:11:in `block (2 levels) in &lt;top (required)&gt;'
</code></pre>

<p>This is because we haven't written any code to show the links on the homepage. Let's add it.</p>

<p>Current links:</p>

<div class="highlight highlight-html"><pre><span class="nt">&lt;ul&gt;</span>
  <span class="err">&lt;</span>% @links.each do |link| %&gt;
    <span class="nt">&lt;li&gt;&lt;a</span> <span class="na">href=</span><span class="s">"&lt;%= link.url %&gt;"</span><span class="nt">&gt;</span><span class="err">&lt;</span>%= link.title %&gt;<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
  <span class="err">&lt;</span>% end %&gt;
<span class="nt">&lt;/ul&gt;</span>
</pre></div>

<div class="highlight highlight-ruby"><pre><span class="n">get</span> <span class="s1">'/'</span> <span class="k">do</span>
  <span class="vi">@links</span> <span class="o">=</span> <span class="no">Link</span><span class="o">.</span><span class="n">all</span>
  <span class="n">erb</span> <span class="ss">:index</span>
<span class="k">end</span>
</pre></div>

<p>Now our tests pass.</p>

<pre><code>
Finished in 0.03551 seconds
2 examples, 0 failures
</code></pre>

<p>Current state is on Github.
<a href="https://github.com/makersacademy/bookmark_manager/tree/7d35ba70c772421e64999eac68a2e28f0501780b">https://github.com/makersacademy/bookmark_manager/tree/7d35ba70c772421e64999eac68a2e28f0501780b</a></p>

<p>Submitting a new link</p>

<p>So, let's add a few basic features to the website. First, we need to somehow submit new links. Let's add a new test for it, adding_links_spec.rb.</p>

<div class="highlight highlight-ruby"><pre><span class="nb">require</span> <span class="s1">'spec_helper'</span>

<span class="n">feature</span> <span class="s2">"User adds a new link"</span> <span class="k">do</span>
  <span class="n">scenario</span> <span class="s2">"when browsing the homepage"</span> <span class="k">do</span>
    <span class="n">expect</span><span class="p">(</span><span class="no">Link</span><span class="o">.</span><span class="n">count</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">eq</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">visit</span> <span class="s1">'/'</span>
    <span class="n">add_link</span><span class="p">(</span><span class="s2">"http://www.makersacademy.com/"</span><span class="p">,</span> <span class="s2">"Makers Academy"</span><span class="p">)</span>
    <span class="n">expect</span><span class="p">(</span><span class="no">Link</span><span class="o">.</span><span class="n">count</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">eq</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">link</span> <span class="o">=</span> <span class="no">Link</span><span class="o">.</span><span class="n">first</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">link</span><span class="o">.</span><span class="n">url</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">eq</span><span class="p">(</span><span class="s2">"http://www.makersacademy.com/"</span><span class="p">)</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">link</span><span class="o">.</span><span class="n">title</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">eq</span><span class="p">(</span><span class="s2">"Makers Academy"</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">add_link</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">title</span><span class="p">)</span>
    <span class="n">within</span><span class="p">(</span><span class="s1">'#new-link'</span><span class="p">)</span> <span class="k">do</span>
      <span class="n">fill_in</span> <span class="s1">'url'</span><span class="p">,</span> <span class="ss">:with</span> <span class="o">=&gt;</span> <span class="n">url</span>
      <span class="n">fill_in</span> <span class="s1">'title'</span><span class="p">,</span> <span class="ss">:with</span> <span class="o">=&gt;</span> <span class="n">title</span>
      <span class="n">click_button</span> <span class="s1">'Add link'</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>

<p>The code should be self-explanatory. We expect to have no links until we go to the homepage and fill out the form inside #new-link element and submit it. Afterwards, we'll have one link in the database with the properties that we specified when creating it.</p>

<p>This test fails, so let's make it pass. First, we'll need to create the form in question.</p>

<div class="highlight highlight-html"><pre><span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"new-link"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;form</span> <span class="na">action=</span><span class="s">"/links"</span> <span class="na">method=</span><span class="s">"post"</span><span class="nt">&gt;</span>
    Url: <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">name=</span><span class="s">"url"</span><span class="nt">&gt;</span>
    Title: <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">name=</span><span class="s">"title"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"submit"</span> <span class="na">value=</span><span class="s">"Add link"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;/form&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</pre></div>

<p>Then we'll need to add a new route that will handle the form submission.</p>

<div class="highlight highlight-ruby"><pre><span class="n">post</span> <span class="s1">'/links'</span> <span class="k">do</span>
  <span class="n">url</span> <span class="o">=</span> <span class="n">params</span><span class="o">[</span><span class="s2">"url"</span><span class="o">]</span>
  <span class="n">title</span> <span class="o">=</span> <span class="n">params</span><span class="o">[</span><span class="s2">"title"</span><span class="o">]</span>
  <span class="no">Link</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="ss">:url</span> <span class="o">=&gt;</span> <span class="n">url</span><span class="p">,</span> <span class="ss">:title</span> <span class="o">=&gt;</span> <span class="n">title</span><span class="p">)</span>
  <span class="n">redirect</span> <span class="n">to</span><span class="p">(</span><span class="s1">'/'</span><span class="p">)</span>
<span class="k">end</span>
</pre></div>

<p>Current state is on Github.
<a href="https://github.com/makersacademy/bookmark_manager/tree/8844773e81ba888327a1bef46737c6cf5c36597f">https://github.com/makersacademy/bookmark_manager/tree/8844773e81ba888327a1bef46737c6cf5c36597f</a></p>

<h2>
<a name="user-content-adding-tags-to-links" class="anchor" href="https://github.com/makersacademy/course/blob/master/bookmark_manager.md#adding-tags-to-links" aria-hidden="true"><span class="octicon octicon-link"></span></a>Adding tags to links</h2>

<p>By now we have a web application that allows us to add new links to the database and show the entire list on the front page. We have integration tests that give us comfort that if something breaks, we'll know about it straight away.</p>

<p>Let's implement a new feature: allowing links to have tags associated with them. As usual, let's start with a test.</p>

<div class="highlight highlight-ruby"><pre>  <span class="n">scenario</span> <span class="s2">"with a few tags"</span> <span class="k">do</span>
    <span class="n">visit</span> <span class="s2">"/"</span>
    <span class="n">add_link</span><span class="p">(</span><span class="s2">"http://www.makersacademy.com/"</span><span class="p">,</span>
                <span class="s2">"Makers Academy"</span><span class="p">,</span>
                <span class="o">[</span><span class="s1">'education'</span><span class="p">,</span> <span class="s1">'ruby'</span><span class="o">]</span><span class="p">)</span>
    <span class="n">link</span> <span class="o">=</span> <span class="no">Link</span><span class="o">.</span><span class="n">first</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">link</span><span class="o">.</span><span class="n">tags</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="kp">include</span><span class="p">(</span><span class="s2">"education"</span><span class="p">)</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">link</span><span class="o">.</span><span class="n">tags</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="kp">include</span><span class="p">(</span><span class="s2">"ruby"</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">add_link</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">tags</span> <span class="o">=</span> <span class="o">[]</span><span class="p">)</span>
    <span class="n">within</span><span class="p">(</span><span class="s1">'#new-link'</span><span class="p">)</span> <span class="k">do</span>
      <span class="n">fill_in</span> <span class="s1">'url'</span><span class="p">,</span> <span class="ss">:with</span> <span class="o">=&gt;</span> <span class="n">url</span>
      <span class="n">fill_in</span> <span class="s1">'title'</span><span class="p">,</span> <span class="ss">:with</span> <span class="o">=&gt;</span> <span class="n">title</span>
      <span class="c1"># our tags will be space separated</span>
      <span class="n">fill_in</span> <span class="s1">'tags'</span><span class="p">,</span> <span class="ss">:with</span> <span class="o">=&gt;</span> <span class="n">tags</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">' '</span><span class="p">)</span>
      <span class="n">click_button</span> <span class="s1">'Add link'</span>
    <span class="k">end</span>
  <span class="k">end</span>
</pre></div>

<p>Note that we modified add_link() method to have the third parameter with a default value to make sure it's still compatible with the other test we wrote earlier. Of course, our test fails.</p>

<pre><code>
1) User adds a new link with a few tags
     Failure/Error: expect(link.tags).to include("education")
     NoMethodError:
       undefined method `tags' for #&lt;Link:0x007fe22c3a95b0&gt;
     # ./spec/features/adding_links_spec.rb:19:in `block (2 levels) in &lt;top (required)&gt;'
</code></pre>

<p>So, the test tells us that the method "tags" that we expect to exist is undefined. This is because our Link model doesn't have any tags associated with it. Let's add a many-to-many relationship to our Link model.</p>

<div class="highlight highlight-ruby"><pre><span class="n">has</span> <span class="n">n</span><span class="p">,</span> <span class="ss">:tags</span><span class="p">,</span> <span class="ss">:through</span> <span class="o">=&gt;</span> <span class="no">Resource</span>
</pre></div>

<p>The details of how datamapper works with many-to-many relationships (:through =&gt; Resource) are well described in its documentation.</p>

<p>Let's go back and run the test. We get another error:</p>

<p>Cannot find the child_model Tag for Link in tags (NameError)</p>

<p>It means that the Link model now expect a Tag model to exist but we never defined it.</p>

<p>Before we do it, let's discuss the process we're going through. We have written a test that describes the functionality we want to see. Then we ran it and it highlighted a problem (no tags associated to a link). We fixed just that problem, no more, no less. We didn't create the Tag class straight away. Then we ran the test again and it told us that we didn't have the model Tag. This is when we decided to create the model Tag to get past this particular error. We'll be repeating this process several times over.</p>

<p>This is what is called test-driven development. You shouldn't merely have tests, they should drive the coding process. On many occasions you'll be able to predict the next error and you'll be tempted to fix a few things in one go. For example, if there were no tags linked to the Link model it was obvious that we should have created a many-to-many relationship and created the Tag model as well. However, be careful not to jump too far: the more code you write without the tests guiding you, the more likely you are to make an error. Some developers prefer to follow test messages very closely, doing the absolute minimum of work required to make them pass. Some move a few error messages at a time (like we've done before when we wrote our first test and wrote a dozen lines of code in one go. There isn't a one rule fits all approach. However, if you're unsure, follow the tests closely: they will guide you towards writing only the necessary amount of good code to get the job done.</p>

<p>So, let's create the Tag model that also has a many-to-many relationship to Link.</p>

<div class="highlight highlight-ruby"><pre><span class="k">class</span> <span class="nc">Tag</span>

  <span class="kp">include</span> <span class="no">DataMapper</span><span class="o">::</span><span class="no">Resource</span>

  <span class="n">has</span> <span class="n">n</span><span class="p">,</span> <span class="ss">:links</span><span class="p">,</span> <span class="ss">:through</span> <span class="o">=&gt;</span> <span class="no">Resource</span>

  <span class="n">property</span> <span class="ss">:id</span><span class="p">,</span> <span class="no">Serial</span>
  <span class="n">property</span> <span class="ss">:text</span><span class="p">,</span> <span class="nb">String</span>

<span class="k">end</span>
</pre></div>

<p>Note that we're doing a few things other than creating an empty datamapper model without letting the tests tell us that we need to do it (add the relationship with Link, add the text property). Use your best judgement when choosing how fast to go.</p>

<p>Let's move over to the next error.</p>

<pre><code>
2) User adds a new link with a few tags
     Failure/Error: fill_in 'tags', :with =&gt; tags.join(' ')
     Capybara::ElementNotFound:
       Unable to find field "tags"
</code></pre>

<p>Our test wants to fill out a field that doesn't exist. Let's fix it.</p>

<div class="highlight highlight-html"><pre>Tags: <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">name=</span><span class="s">"tags"</span><span class="nt">&gt;</span>
</pre></div>

<p>Next error:</p>

<pre><code>
Failure/Error: expect(link.tags).to include("education")
       expected [] to include "education"
</code></pre>

<p>So, the test is filling out the form correctly since we added a new input fields but the data doesn't end up in the database. Time to fix it in server.rb.</p>

<div class="highlight highlight-ruby"><pre><span class="n">tags</span> <span class="o">=</span> <span class="n">params</span><span class="o">[</span><span class="s2">"tags"</span><span class="o">].</span><span class="n">split</span><span class="p">(</span><span class="s2">" "</span><span class="p">)</span><span class="o">.</span><span class="n">map</span> <span class="k">do</span> <span class="o">|</span><span class="n">tag</span><span class="o">|</span>
  <span class="c1"># this will either find this tag or create</span>
  <span class="c1"># it if it doesn't exist already</span>
  <span class="no">Tag</span><span class="o">.</span><span class="n">first_or_create</span><span class="p">(</span><span class="ss">:text</span> <span class="o">=&gt;</span> <span class="n">tag</span><span class="p">)</span>
<span class="k">end</span>
<span class="no">Link</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="ss">:url</span> <span class="o">=&gt;</span> <span class="n">url</span><span class="p">,</span> <span class="ss">:title</span> <span class="o">=&gt;</span> <span class="n">title</span><span class="p">,</span> <span class="ss">:tags</span> <span class="o">=&gt;</span> <span class="n">tags</span><span class="p">)</span>
</pre></div>

<p>Note that we're searching for a tag record in the database (or creating an instance of the Tag class if it doesn't exist) and then passing an array of instances to Link, as opposed to passing just the text. This is because a Tag is not simply a string, it's a database record that has text and id but may have other properties in the future (user_id of the user who created it, created_at timestamp, etc).</p>

<p>However, if we run the test, we'll still get an error.</p>

<pre><code>Failure/Error: expect(link.tags).to include("education")
       expected [#&lt;Tag @id=1 @text="education" @link_id=4&gt;, #&lt;Tag @id=2 @text="ruby" @link_id=4&gt;] to include "education"
       Diff:
       @@ -1,2 +1,2 @@
       -["education"]
       +[#&lt;Tag @id=1 @text="education" @link_id=4&gt;, #&lt;Tag @id=2 @text="ruby" @link_id=4&gt;]
</code></pre>

<p>It turns out we made a mistake in out test. Instead of expecting the link.tags array to contain strings, we should expect it to contain instances of Tag object. Let's fix the test by mapping the Tag instances to the text they contain.</p>

<div class="highlight highlight-ruby"><pre><span class="n">expect</span><span class="p">(</span><span class="n">link</span><span class="o">.</span><span class="n">tags</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="o">&amp;</span><span class="ss">:text</span><span class="p">))</span><span class="o">.</span><span class="n">to</span> <span class="kp">include</span><span class="p">(</span><span class="s2">"education"</span><span class="p">)</span>
<span class="n">expect</span><span class="p">(</span><span class="n">link</span><span class="o">.</span><span class="n">tags</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="o">&amp;</span><span class="ss">:text</span><span class="p">))</span><span class="o">.</span><span class="n">to</span> <span class="kp">include</span><span class="p">(</span><span class="s2">"ruby"</span><span class="p">)</span>

</pre></div>

<p>Now all our tests pass.</p>

<pre><code>Finished in 0.12076 seconds
4 examples, 0 failures
</code></pre>

<p>Current state is on Github.
<a href="https://github.com/makersacademy/bookmark_manager/tree/88dd9bc90041fc02dd5f335ad4ddfc0eab430c4e">https://github.com/makersacademy/bookmark_manager/tree/88dd9bc90041fc02dd5f335ad4ddfc0eab430c4e</a></p>

<h2>
<a name="user-content-filtering-by-tag" class="anchor" href="https://github.com/makersacademy/course/blob/master/bookmark_manager.md#filtering-by-tag" aria-hidden="true"><span class="octicon octicon-link"></span></a>Filtering by tag</h2>

<p>Adding tags to links is useful but it'd be even more useful to be able to filter links by a tag. Let's write a test for this in listing_all_links_spec first.</p>

<div class="highlight highlight-ruby"><pre><span class="n">scenario</span> <span class="s2">"filtered by a tag"</span> <span class="k">do</span>
  <span class="n">visit</span> <span class="s1">'/tags/search'</span>
  <span class="n">expect</span><span class="p">(</span><span class="n">page</span><span class="p">)</span><span class="o">.</span><span class="n">not_to</span> <span class="n">have_content</span><span class="p">(</span><span class="s2">"Makers Academy"</span><span class="p">)</span>
  <span class="n">expect</span><span class="p">(</span><span class="n">page</span><span class="p">)</span><span class="o">.</span><span class="n">not_to</span> <span class="n">have_content</span><span class="p">(</span><span class="s2">"Code.org"</span><span class="p">)</span>
  <span class="n">expect</span><span class="p">(</span><span class="n">page</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">have_content</span><span class="p">(</span><span class="s2">"Google"</span><span class="p">)</span>
  <span class="n">expect</span><span class="p">(</span><span class="n">page</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">have_content</span><span class="p">(</span><span class="s2">"Bing"</span><span class="p">)</span>
<span class="k">end</span>
</pre></div>

<p>Let's also update the before(:each) block to create some test data.</p>

<div class="highlight highlight-ruby"><pre>  <span class="n">before</span><span class="p">(</span><span class="ss">:each</span><span class="p">)</span> <span class="p">{</span>
    <span class="no">Link</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="ss">:url</span> <span class="o">=&gt;</span> <span class="s2">"http://www.makersacademy.com"</span><span class="p">,</span>
                <span class="ss">:title</span> <span class="o">=&gt;</span> <span class="s2">"Makers Academy"</span><span class="p">,</span>
                <span class="ss">:tags</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="no">Tag</span><span class="o">.</span><span class="n">first_or_create</span><span class="p">(</span><span class="ss">:text</span> <span class="o">=&gt;</span> <span class="s1">'education'</span><span class="p">)</span><span class="o">]</span><span class="p">)</span>
    <span class="no">Link</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="ss">:url</span> <span class="o">=&gt;</span> <span class="s2">"http://www.google.com"</span><span class="p">,</span>
                <span class="ss">:title</span> <span class="o">=&gt;</span> <span class="s2">"Google"</span><span class="p">,</span>
                <span class="ss">:tags</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="no">Tag</span><span class="o">.</span><span class="n">first_or_create</span><span class="p">(</span><span class="ss">:text</span> <span class="o">=&gt;</span> <span class="s1">'search'</span><span class="p">)</span><span class="o">]</span><span class="p">)</span>
    <span class="no">Link</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="ss">:url</span> <span class="o">=&gt;</span> <span class="s2">"http://www.bing.com"</span><span class="p">,</span>
                <span class="ss">:title</span> <span class="o">=&gt;</span> <span class="s2">"Bing"</span><span class="p">,</span>
                <span class="ss">:tags</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="no">Tag</span><span class="o">.</span><span class="n">first_or_create</span><span class="p">(</span><span class="ss">:text</span> <span class="o">=&gt;</span> <span class="s1">'search'</span><span class="p">)</span><span class="o">]</span><span class="p">)</span>
    <span class="no">Link</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="ss">:url</span> <span class="o">=&gt;</span> <span class="s2">"http://www.code.org"</span><span class="p">,</span>
                <span class="ss">:title</span> <span class="o">=&gt;</span> <span class="s2">"Code.org"</span><span class="p">,</span>
                <span class="ss">:tags</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="no">Tag</span><span class="o">.</span><span class="n">first_or_create</span><span class="p">(</span><span class="ss">:text</span> <span class="o">=&gt;</span> <span class="s1">'education'</span><span class="p">)</span><span class="o">]</span><span class="p">)</span>
  <span class="p">}</span>
</pre></div>

<p>Sure enough, the test fails because Sinatra returns a "404 Not Found" page for the route that doesn't exist yet. Let's add the route.</p>

<div class="highlight highlight-ruby"><pre><span class="n">get</span> <span class="s1">'/tags/:text'</span> <span class="k">do</span>
  <span class="n">tag</span> <span class="o">=</span> <span class="no">Tag</span><span class="o">.</span><span class="n">first</span><span class="p">(</span><span class="ss">:text</span> <span class="o">=&gt;</span> <span class="n">params</span><span class="o">[</span><span class="ss">:text</span><span class="o">]</span><span class="p">)</span>
  <span class="vi">@links</span> <span class="o">=</span> <span class="n">tag</span> <span class="p">?</span> <span class="n">tag</span><span class="o">.</span><span class="n">links</span> <span class="p">:</span> <span class="o">[]</span>
  <span class="n">erb</span> <span class="ss">:index</span>
<span class="k">end</span>
</pre></div>

<p>First we find the tag that we need (note the use of a named parameter in the route). Then, if the tag exists, we get associated links. Otherwise, we just return an empty array.</p>

<p>Current state is on Github
<a href="https://github.com/makersacademy/bookmark_manager/tree/e45ed5d9c3289c8320632e6aadcc56c3d624fbcc">https://github.com/makersacademy/bookmark_manager/tree/e45ed5d9c3289c8320632e6aadcc56c3d624fbcc</a></p>

<h2>
<a name="user-content-bookmark-manager--adding-user-accounts" class="anchor" href="https://github.com/makersacademy/course/blob/master/bookmark_manager.md#bookmark-manager--adding-user-accounts" aria-hidden="true"><span class="octicon octicon-link"></span></a>Bookmark manager – Adding user accounts</h2>

<p>Let's implement basic user account functionality using what we learned in Security. We want users to be able to register on the website, so that every link and tag could be attributed to a specific user. This section will rely on your understanding of what we (will) have discussed in Security.</p>

<p>The goal of this exercise is to demonstrate how to create a user management system from scratch without using user management libraries (we'll be using them later in the course, though).</p>

<p>We will add the following functionality:</p>

<ul class="task-list">
<li>Sign up with an email and a password</li>
<li>Sign in</li>
<li>Sign out</li>
<li>A welcome message for the logged in user</li>
<li>Every link and every tag will be linked to the user that created it, unless the user was anonymous</li>
</ul><p>We want to have a separate database table for all our users. For this we'll need to have a User model that will store the email and password-related information (hash, salt).</p>

<p>Bookmark manager - Adding user accounts - signing up
Let's begin with a test, as usual. The integration test should go to /spec/features/user_management_spec.rb.</p>

<div class="highlight highlight-ruby"><pre><span class="nb">require</span> <span class="s1">'spec_helper'</span>

<span class="n">feature</span> <span class="s2">"User signs up"</span> <span class="k">do</span>

  <span class="c1"># Strictly speaking, the tests that check the UI</span>
  <span class="c1"># (have_content, etc.) should be separate from the tests</span>
  <span class="c1"># that check what we have in the DB. The reason is that</span>
  <span class="c1"># you should test one thing at a time, whereas</span>
  <span class="c1"># by mixing the two we're testing both</span>
  <span class="c1"># the business logic and the views.</span>
  <span class="c1">#</span>
  <span class="c1"># However, let's not worry about this yet</span>
  <span class="c1"># to keep the example simple.</span>


  <span class="n">scenario</span> <span class="s2">"when being logged out"</span> <span class="k">do</span>
    <span class="n">expect</span><span class="p">{</span> <span class="n">sign_up</span> <span class="p">}</span><span class="o">.</span><span class="n">to</span> <span class="n">change</span><span class="p">(</span><span class="no">User</span><span class="p">,</span> <span class="ss">:count</span><span class="p">)</span><span class="o">.</span><span class="n">by</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">page</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">have_content</span><span class="p">(</span><span class="s2">"Welcome, alice@example.com"</span><span class="p">)</span>
    <span class="n">expect</span><span class="p">(</span><span class="no">User</span><span class="o">.</span><span class="n">first</span><span class="o">.</span><span class="n">email</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">eq</span><span class="p">(</span><span class="s2">"alice@example.com"</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">sign_up</span><span class="p">(</span><span class="n">email</span> <span class="o">=</span> <span class="s2">"alice@example.com"</span><span class="p">,</span>
              <span class="n">password</span> <span class="o">=</span> <span class="s2">"oranges!"</span><span class="p">)</span>
    <span class="n">visit</span> <span class="s1">'/users/new'</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">page</span><span class="o">.</span><span class="n">status_code</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">eq</span><span class="p">(</span><span class="mi">200</span><span class="p">)</span>
    <span class="n">fill_in</span> <span class="ss">:email</span><span class="p">,</span> <span class="ss">:with</span> <span class="o">=&gt;</span> <span class="n">email</span>
    <span class="n">fill_in</span> <span class="ss">:password</span><span class="p">,</span> <span class="ss">:with</span> <span class="o">=&gt;</span> <span class="n">password</span>
    <span class="n">click_button</span> <span class="s2">"Sign up"</span>
  <span class="k">end</span>

<span class="k">end</span>
</pre></div>

<p>Running the test tells us that we haven't got the User class. Let's create a basic model in /lib/user.rb (where the Link model is).</p>

<div class="highlight highlight-ruby"><pre><span class="k">class</span> <span class="nc">User</span>

  <span class="kp">include</span> <span class="no">DataMapper</span><span class="o">::</span><span class="no">Resource</span>

  <span class="n">property</span> <span class="ss">:id</span><span class="p">,</span> <span class="no">Serial</span>
  <span class="n">property</span> <span class="ss">:email</span><span class="p">,</span> <span class="nb">String</span>

<span class="k">end</span>
</pre></div>

<p>A word of caution. If you declare a property, you shouldn't declare an accessor (or reader, or writer) for that property because you'll override datamapper's default functionality. Ruby will not throw any warning in this case. In other words, if you do this:</p>

<div class="highlight highlight-ruby"><pre><span class="c1"># this is wrong!</span>
<span class="n">property</span> <span class="ss">:description</span><span class="p">,</span> <span class="no">Text</span>
<span class="kp">attr_reader</span> <span class="ss">:description</span>
</pre></div>

<p>you will not be able to get the description back from the database.</p>

<p>The next error in our test suite is not having the form to fill in to sign up. That's easy to fix by updating app/server.rb (or just server.rb if you chose to place it in the root folder).</p>

<div class="highlight highlight-ruby"><pre><span class="n">get</span> <span class="s1">'/users/new'</span> <span class="k">do</span>
  <span class="c1"># note the view is in views/users/new.erb</span>
  <span class="c1"># we need the quotes because otherwise</span>
  <span class="c1"># ruby would divide the symbol :users by the</span>
  <span class="c1"># variable new (which makes no sense)</span>
  <span class="n">erb</span> <span class="ss">:"users/new"</span>
<span class="k">end</span>

</pre></div>

<p>and /views/users/new.erb.</p>

<div class="highlight highlight-html"><pre><span class="nt">&lt;h1&gt;</span>Please sign up<span class="nt">&lt;/h1&gt;</span>

<span class="nt">&lt;form</span> <span class="na">action=</span><span class="s">"/users"</span> <span class="na">method=</span><span class="s">"post"</span><span class="nt">&gt;</span>
  Email: <span class="nt">&lt;input</span> <span class="na">name=</span><span class="s">"email"</span> <span class="na">type=</span><span class="s">"text"</span><span class="nt">&gt;</span>
  Password: <span class="nt">&lt;input</span> <span class="na">name=</span><span class="s">"password"</span> <span class="na">type=</span><span class="s">"password"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"submit"</span> <span class="na">value=</span><span class="s">"Sign up"</span><span class="nt">&gt;</span>
<span class="nt">&lt;/form&gt;</span>

</pre></div>

<p>Now the test will be able to fill out the form but the form submits to the route POST /users that doesn't exist. Let's fix this in /app/server.rb</p>

<div class="highlight highlight-ruby"><pre><span class="n">post</span> <span class="s1">'/users'</span> <span class="k">do</span>
  <span class="no">User</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="ss">:email</span> <span class="o">=&gt;</span> <span class="n">params</span><span class="o">[</span><span class="ss">:email</span><span class="o">]</span><span class="p">,</span>
              <span class="ss">:password</span> <span class="o">=&gt;</span> <span class="n">params</span><span class="o">[</span><span class="ss">:password</span><span class="o">]</span><span class="p">)</span>
  <span class="n">redirect</span> <span class="n">to</span><span class="p">(</span><span class="s1">'/'</span><span class="p">)</span>
<span class="k">end</span>
</pre></div>

<p>This code is straighforward enough. However, we already have a problem. Our User model doesn't know anything about the password, so our test still fails. Let's extend our User class (/lib/user.rb).</p>

<div class="highlight highlight-ruby"><pre><span class="c1"># bcrypt will generate the password hash</span>
<span class="nb">require</span> <span class="s1">'bcrypt'</span>
<span class="k">class</span> <span class="nc">User</span>

  <span class="kp">include</span> <span class="no">DataMapper</span><span class="o">::</span><span class="no">Resource</span>

  <span class="n">property</span> <span class="ss">:id</span><span class="p">,</span> <span class="no">Serial</span>
  <span class="n">property</span> <span class="ss">:email</span><span class="p">,</span> <span class="nb">String</span>
  <span class="c1"># this will store both the password and the salt</span>
  <span class="c1"># It's Text and not String because String holds</span>
  <span class="c1"># 50 characters by default</span>
  <span class="c1"># and it's not enough for the hash and salt</span>
  <span class="n">property</span> <span class="ss">:password_digest</span><span class="p">,</span> <span class="no">Text</span>

  <span class="c1"># when assigned the password, we don't store it directly</span>
  <span class="c1"># instead, we generate a password digest, that looks like this:</span>
  <span class="c1"># "$2a$10$vI8aWBnW3fID.ZQ4/zo1G.q1lRps.9cGLcZEiGDMVr5yUP1KUOYTa"</span>
  <span class="c1"># and save it in the database. This digest, provided by bcrypt,</span>
  <span class="c1"># has both the password hash and the salt. We save it to the</span>
  <span class="c1"># database instead of the plain password for security reasons.</span>
  <span class="k">def</span> <span class="nf">password</span><span class="o">=</span><span class="p">(</span><span class="n">password</span><span class="p">)</span>
    <span class="nb">self</span><span class="o">.</span><span class="n">password_digest</span> <span class="o">=</span> <span class="no">BCrypt</span><span class="o">::</span><span class="no">Password</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">password</span><span class="p">)</span>
  <span class="k">end</span>

<span class="k">end</span>

</pre></div>

<p>Now our user is created in the database but the test would still fail because it expects to see a welcome message for the user. Let's log in the user automatically on sign up. To do this, we'll store the user id in the session (we looked at how sessions work in BattleShips – web version).</p>

<p>First, we need to enable the sessions and set the encryption key to make sure nobody can tamper with our cookies. This is done by changing Sinatra's configuration, so it goes into /server.rb.</p>

<div class="highlight highlight-ruby"><pre><span class="n">enable</span> <span class="ss">:sessions</span>
<span class="n">set</span> <span class="ss">:session_secret</span><span class="p">,</span> <span class="s1">'super secret'</span>
</pre></div>

<p>Then, let's save the user id in the session after it's created (/server.rb).</p>

<div class="highlight highlight-ruby"><pre><span class="n">post</span> <span class="s1">'/users'</span> <span class="k">do</span>
  <span class="n">user</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="ss">:email</span> <span class="o">=&gt;</span> <span class="n">params</span><span class="o">[</span><span class="ss">:email</span><span class="o">]</span><span class="p">,</span>
                     <span class="ss">:password</span> <span class="o">=&gt;</span> <span class="n">params</span><span class="o">[</span><span class="ss">:password</span><span class="o">]</span><span class="p">)</span>
  <span class="n">session</span><span class="o">[</span><span class="ss">:user_id</span><span class="o">]</span> <span class="o">=</span> <span class="n">user</span><span class="o">.</span><span class="n">id</span>
  <span class="n">redirect</span> <span class="n">to</span><span class="p">(</span><span class="s1">'/'</span><span class="p">)</span>
<span class="k">end</span>

</pre></div>

<p>Then, let's create a helper that will give us access to the current user, if logged in (server.rb).</p>

<div class="highlight highlight-ruby"><pre><span class="n">helpers</span> <span class="k">do</span>

  <span class="k">def</span> <span class="nf">current_user</span>
    <span class="vi">@current_user</span> <span class="o">||=</span><span class="no">User</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">session</span><span class="o">[</span><span class="ss">:user_id</span><span class="o">]</span><span class="p">)</span> <span class="k">if</span> <span class="n">session</span><span class="o">[</span><span class="ss">:user_id</span><span class="o">]</span>
  <span class="k">end</span>

<span class="k">end</span>

</pre></div>

<p>Finally, let's use this helper in the layout file (/views/layout.erb)</p>

<div class="highlight highlight-html"><pre><span class="nt">&lt;body&gt;</span>
  <span class="err">&lt;</span>% if current_user %&gt;
    Welcome, <span class="err">&lt;</span>%= current_user.email %&gt;
  <span class="err">&lt;</span>% end %&gt;
  <span class="err">&lt;</span>%= yield %&gt;
<span class="nt">&lt;/body&gt;</span>

</pre></div>

<p>Finally, make sure 'bcrypt-ruby' is in your Gemfile and it's installed. Our test finally passes.</p>

<p>Let's clean the code up a little bit by extracting the helpers and datamapper-related code to external files and moving server.rb, views and helpers to /app. Now the codebase looks a little bit cleaner.</p>

<p>Current state is on Github
<a href="https://github.com/makersacademy/bookmark_manager/tree/1b6fada4c9fdaa5e44cc62fdd31ddf5d7706d139">https://github.com/makersacademy/bookmark_manager/tree/1b6fada4c9fdaa5e44cc62fdd31ddf5d7706d139</a></p>

<h3>
<a name="user-content-bookmark-manager---adding-user-accounts---password-confirmation" class="anchor" href="https://github.com/makersacademy/course/blob/master/bookmark_manager.md#bookmark-manager---adding-user-accounts---password-confirmation" aria-hidden="true"><span class="octicon octicon-link"></span></a>Bookmark manager - Adding user accounts - Password confirmation</h3>

<p>Now a user can register on our website but it would be nice to ask for password confirmation on registration to make sure there's no mistake in the password. Let's start by adding a test for this.</p>

<div class="highlight highlight-ruby"><pre>  <span class="n">scenario</span> <span class="s2">"with a password that doesn't match"</span> <span class="k">do</span>
    <span class="n">expect</span><span class="p">{</span> <span class="n">sign_up</span><span class="p">(</span><span class="s1">'a@a.com'</span><span class="p">,</span> <span class="s1">'pass'</span><span class="p">,</span> <span class="s1">'wrong'</span><span class="p">)</span> <span class="p">}</span><span class="o">.</span><span class="n">to</span> <span class="n">change</span><span class="p">(</span><span class="no">User</span><span class="p">,</span> <span class="ss">:count</span><span class="p">)</span><span class="o">.</span><span class="n">by</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">sign_up</span><span class="p">(</span><span class="n">email</span> <span class="o">=</span> <span class="s2">"alice@example.com"</span><span class="p">,</span>
              <span class="n">password</span> <span class="o">=</span> <span class="s2">"oranges!"</span><span class="p">,</span>
              <span class="n">password_confirmation</span> <span class="o">=</span> <span class="s2">"oranges!"</span><span class="p">)</span>
    <span class="n">visit</span> <span class="s1">'/users/new'</span>
    <span class="n">fill_in</span> <span class="ss">:email</span><span class="p">,</span> <span class="ss">:with</span> <span class="o">=&gt;</span> <span class="n">email</span>
    <span class="n">fill_in</span> <span class="ss">:password</span><span class="p">,</span> <span class="ss">:with</span> <span class="o">=&gt;</span> <span class="n">password</span>
    <span class="n">fill_in</span> <span class="ss">:password_confirmation</span><span class="p">,</span> <span class="ss">:with</span> <span class="o">=&gt;</span> <span class="n">password_confirmation</span>
    <span class="n">click_button</span> <span class="s2">"Sign up"</span>
  <span class="k">end</span>

</pre></div>

<p>So we pass a non-matching password and we expect the user to not be created. Modify the erb template accordingly and then add the virtual attributes to the User model.</p>

<div class="highlight highlight-ruby"><pre><span class="kp">attr_reader</span> <span class="ss">:password</span>
<span class="kp">attr_accessor</span> <span class="ss">:password_confirmation</span>

<span class="c1"># this is datamapper's method of validating the model.</span>
<span class="c1"># The model will not be saved unless both password</span>
<span class="c1"># and password_confirmation are the same</span>
<span class="c1"># read more about it in the documentation</span>
<span class="c1"># http://datamapper.org/docs/validations.html</span>
<span class="n">validates_confirmation_of</span> <span class="ss">:password</span>

</pre></div>

<p>The reason we need the reader for :password and :password_confirmation is that datamapper should have access to both values to make sure they are the same.</p>

<p>The reason we need the writer for :password_confirmation is that we're now passing the password confirmation to the model in the controller.</p>

<div class="highlight highlight-ruby"><pre><span class="n">post</span> <span class="s1">'/users'</span> <span class="k">do</span>
  <span class="n">user</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="ss">:email</span> <span class="o">=&gt;</span> <span class="n">params</span><span class="o">[</span><span class="ss">:email</span><span class="o">]</span><span class="p">,</span>
              <span class="ss">:password</span> <span class="o">=&gt;</span> <span class="n">params</span><span class="o">[</span><span class="ss">:password</span><span class="o">]</span><span class="p">,</span>
              <span class="ss">:password_confirmation</span> <span class="o">=&gt;</span> <span class="n">params</span><span class="o">[</span><span class="ss">:password_confirmation</span><span class="o">]</span><span class="p">)</span>
  <span class="n">session</span><span class="o">[</span><span class="ss">:user_id</span><span class="o">]</span> <span class="o">=</span> <span class="n">user</span><span class="o">.</span><span class="n">id</span>
  <span class="n">redirect</span> <span class="n">to</span><span class="p">(</span><span class="s1">'/'</span><span class="p">)</span>
<span class="k">end</span>
</pre></div>

<p>However, you may wonder what happens to :password since we wrote a custom writer for this property.</p>

<div class="highlight highlight-ruby"><pre>  <span class="k">def</span> <span class="nf">password</span><span class="o">=</span><span class="p">(</span><span class="n">password</span><span class="p">)</span>
    <span class="nb">self</span><span class="o">.</span><span class="n">password_digest</span> <span class="o">=</span> <span class="no">BCrypt</span><span class="o">::</span><span class="no">Password</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">password</span><span class="p">)</span>
  <span class="k">end</span>
</pre></div>

<p>Because we have a custom writer for this property, we'll never be storing the plain text password in an instance variable and datamapper will be unable to compare it to the password confirmation. Let's fix it by modifying our writer.</p>

<div class="highlight highlight-ruby"><pre>  <span class="k">def</span> <span class="nf">password</span><span class="o">=</span><span class="p">(</span><span class="n">password</span><span class="p">)</span>
    <span class="vi">@password</span> <span class="o">=</span> <span class="n">password</span>
    <span class="nb">self</span><span class="o">.</span><span class="n">password_digest</span> <span class="o">=</span> <span class="no">BCrypt</span><span class="o">::</span><span class="no">Password</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">password</span><span class="p">)</span>
  <span class="k">end</span>

</pre></div>

<p>Now the test passes.</p>

<p>Current state is on Github
<a href="https://github.com/makersacademy/bookmark_manager/tree/f41a3a2b35451eadd0773e0abbc8e85aba481e90">https://github.com/makersacademy/bookmark_manager/tree/f41a3a2b35451eadd0773e0abbc8e85aba481e90</a></p>

<h3>
<a name="user-content-bookmark-manager---adding-user-accounts---handling-input-errors" class="anchor" href="https://github.com/makersacademy/course/blob/master/bookmark_manager.md#bookmark-manager---adding-user-accounts---handling-input-errors" aria-hidden="true"><span class="octicon octicon-link"></span></a>Bookmark manager - Adding user accounts - Handling input errors</h3>

<p>Right now our code has no logic for handling the situation when the user enters an incorrect password confirmation. It just fails silently, redirecting the user to the homepage. In the controller, the user.id will be nil because datamapper won't be able to save the record if the passwords don't match.</p>

<div class="highlight highlight-ruby"><pre><span class="n">post</span> <span class="s1">'/users'</span> <span class="k">do</span>
  <span class="n">user</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="ss">:email</span> <span class="o">=&gt;</span> <span class="n">params</span><span class="o">[</span><span class="ss">:email</span><span class="o">]</span><span class="p">,</span>
              <span class="ss">:password</span> <span class="o">=&gt;</span> <span class="n">params</span><span class="o">[</span><span class="ss">:password</span><span class="o">]</span><span class="p">,</span>
              <span class="ss">:password_confirmation</span> <span class="o">=&gt;</span> <span class="n">params</span><span class="o">[</span><span class="ss">:password_confirmation</span><span class="o">]</span><span class="p">)</span>
  <span class="c1"># the user.id will be nil if the user wasn't saved</span>
  <span class="c1"># because of password mismatch</span>
  <span class="n">session</span><span class="o">[</span><span class="ss">:user_id</span><span class="o">]</span> <span class="o">=</span> <span class="n">user</span><span class="o">.</span><span class="n">id</span>
  <span class="n">redirect</span> <span class="n">to</span><span class="p">(</span><span class="s1">'/'</span><span class="p">)</span>
<span class="k">end</span>
</pre></div>

<p>Let's extend the test to expect a redirection back to the sign up form if the passwords don't match.</p>

<div class="highlight highlight-ruby"><pre>  <span class="n">scenario</span> <span class="s2">"with a password that doesn't match"</span> <span class="k">do</span>
    <span class="n">expect</span><span class="p">{</span> <span class="n">sign_up</span><span class="p">(</span><span class="s1">'a@a.com'</span><span class="p">,</span> <span class="s1">'pass'</span><span class="p">,</span> <span class="s1">'wrong'</span><span class="p">)</span> <span class="p">}</span><span class="o">.</span><span class="n">to</span> <span class="n">change</span><span class="p">(</span><span class="no">User</span><span class="p">,</span> <span class="ss">:count</span><span class="p">)</span><span class="o">.</span><span class="n">by</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">current_path</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">eq</span><span class="p">(</span><span class="s1">'/users'</span><span class="p">)</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">page</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">have_content</span><span class="p">(</span><span class="s2">"Sorry, your passwords don't match"</span><span class="p">)</span>
  <span class="k">end</span>
</pre></div>

<p>This test expects the website to stay at /users, instead of navigating to the home page (note the use of the current_path helper, provided by capybara). The reason is that we are submitting the form to /users and we don't want the redirection to happen if the user is not saved because we will lose the unsaved data.</p>

<p>Let's suppose we have a longer sign up form. A user fills out 20 fields but makes a mistake in password_confirmation. If we refresh the page by doing a redirect, we'll lose all information that was entered in the form because it was never saved to the database. This information only exists in memory, as properties of the invalid User model that is alive only for the duration of this request.</p>

<p>So, instead of redirecting the user, let's show the same form but this time we'll populate it using our invalid User object.</p>

<div class="highlight highlight-ruby"><pre><span class="n">post</span> <span class="s1">'/users'</span> <span class="k">do</span>
  <span class="c1"># we just initialize the object</span>
  <span class="c1"># without saving it. It may be invalid</span>
  <span class="n">user</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="ss">:email</span> <span class="o">=&gt;</span> <span class="n">params</span><span class="o">[</span><span class="ss">:email</span><span class="o">]</span><span class="p">,</span>
              <span class="ss">:password</span> <span class="o">=&gt;</span> <span class="n">params</span><span class="o">[</span><span class="ss">:password</span><span class="o">]</span><span class="p">,</span>
              <span class="ss">:password_confirmation</span> <span class="o">=&gt;</span> <span class="n">params</span><span class="o">[</span><span class="ss">:password_confirmation</span><span class="o">]</span><span class="p">)</span>
  <span class="c1"># let's try saving it</span>
  <span class="c1"># if the model is valid,</span>
  <span class="c1"># it will be saved</span>
  <span class="k">if</span> <span class="n">user</span><span class="o">.</span><span class="n">save</span>
    <span class="n">session</span><span class="o">[</span><span class="ss">:user_id</span><span class="o">]</span> <span class="o">=</span> <span class="n">user</span><span class="o">.</span><span class="n">id</span>
    <span class="n">redirect</span> <span class="n">to</span><span class="p">(</span><span class="s1">'/'</span><span class="p">)</span>
    <span class="c1"># if it's not valid,</span>
    <span class="c1"># we'll show the same</span>
    <span class="c1"># form again</span>
  <span class="k">else</span>
    <span class="n">erb</span> <span class="ss">:"users/new"</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>

<p>This is a fairly common pattern of handling potential errors. Instead of creating the object straight away, you initialise it, attempt to save and handle both possibilities.</p>

<p>However, how will the data (in our case the email the user entered) make its way from the user object to the re-rendered form? Let's make the user an instance variable and update the view.</p>

<div class="highlight highlight-ruby"><pre><span class="n">post</span> <span class="s1">'/users'</span> <span class="k">do</span>
  <span class="vi">@user</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="ss">:email</span> <span class="o">=&gt;</span> <span class="n">params</span><span class="o">[</span><span class="ss">:email</span><span class="o">]</span><span class="p">,</span>
              <span class="ss">:password</span> <span class="o">=&gt;</span> <span class="n">params</span><span class="o">[</span><span class="ss">:password</span><span class="o">]</span><span class="p">,</span>
              <span class="ss">:password_confirmation</span> <span class="o">=&gt;</span> <span class="n">params</span><span class="o">[</span><span class="ss">:password_confirmation</span><span class="o">]</span><span class="p">)</span>
  <span class="k">if</span> <span class="vi">@user</span><span class="o">.</span><span class="n">save</span>
    <span class="n">session</span><span class="o">[</span><span class="ss">:user_id</span><span class="o">]</span> <span class="o">=</span> <span class="vi">@user</span><span class="o">.</span><span class="n">id</span>
    <span class="n">redirect</span> <span class="n">to</span><span class="p">(</span><span class="s1">'/'</span><span class="p">)</span>
  <span class="k">else</span>
    <span class="n">erb</span> <span class="ss">:"users/new"</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>

<div class="highlight highlight-html"><pre>Email: <span class="nt">&lt;input</span> <span class="na">name=</span><span class="s">"email"</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">value=</span><span class="s">"&lt;%= @user.email %&gt;"</span><span class="nt">&gt;</span>
</pre></div>

<p>Now the email will be part of the form when it's rendered again.</p>

<p>Because the view now expects @user instance variable, we must make sure that it's available in the /users/new route as well.</p>

<div class="highlight highlight-ruby"><pre><span class="n">get</span> <span class="s1">'/users/new'</span> <span class="k">do</span>
  <span class="vi">@user</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">new</span>
  <span class="n">erb</span> <span class="ss">:"users/new"</span>
<span class="k">end</span>

</pre></div>

<p>An new instance of the user will simply return nil for @user.email.</p>

<p>Finally, let's display a flash message, notifying the user of the error. Add the rack-flash3 gem as described in BattleShip – web version and set the flash before the view is re-rendered.</p>

<div class="highlight highlight-ruby"><pre><span class="k">if</span> <span class="vi">@user</span><span class="o">.</span><span class="n">save</span>
  <span class="n">session</span><span class="o">[</span><span class="ss">:user_id</span><span class="o">]</span> <span class="o">=</span> <span class="vi">@user</span><span class="o">.</span><span class="n">id</span>
  <span class="n">redirect</span> <span class="n">to</span><span class="p">(</span><span class="s1">'/'</span><span class="p">)</span>
<span class="k">else</span>
  <span class="n">flash</span><span class="o">[</span><span class="ss">:notice</span><span class="o">]</span> <span class="o">=</span> <span class="s2">"Sorry, your passwords don't match"</span>
  <span class="n">erb</span> <span class="ss">:"users/new"</span>
<span class="k">end</span>
</pre></div>

<p>Finally, display it in the layout.erb.</p>

<div class="highlight highlight-ruby"><pre><span class="o">&lt;</span><span class="sx">% if </span><span class="n">flash</span><span class="o">[</span><span class="ss">:notice</span><span class="o">]</span> <span class="sx">%&gt;</span>
<span class="sx">  &lt;div id="notice"&gt;</span><span class="o">&lt;%=</span> <span class="n">flash</span><span class="o">[</span><span class="ss">:notice</span><span class="o">]</span> <span class="sx">%&gt;&lt;/div&gt;</span>
<span class="o">&lt;</span><span class="sx">% end </span><span class="o">%&gt;</span>
</pre></div>

<p>It will be displayed on top the page that was re-rendered (note the /users path).</p>

<p><a href="./course bookmark_manager.md at master · makersacademy course_files/68747470733a2f2f646368746d36723437316d75692e636c6f756466726f6e742e6e65742f6861636b7061642e636f6d5f6a75624d786442726a6e695f702e35323536375f313338303130353939303231385f53637265656e25323053686f74253230323031332d30392d3235253230617425323031312e34362e30312e706" target="_blank"><img src="./course bookmark_manager.md at master · makersacademy course_files/68747470733a2f2f646368746d36723437316d75692e636c6f756466726f6e742e6e65742f6861636b7061642e636f6d5f6a75624d786442726a6e695f702e35323536375f313338303130353939303231385f53637265656e25323053686f74253230323031332d30392d3235253230617425323031312e34362e30312e706" alt="alt text" title="bookmark manager" data-canonical-src="https://dchtm6r471mui.cloudfront.net/hackpad.com_jubMxdBrjni_p.52567_1380105990218_Screen%20Shot%202013-09-25%20at%2011.46.01.png" style="max-width:100%;"></a></p>

<p>Finally, our tests pass.</p>

<pre><code>Finished in 0.40513 seconds
7 examples, 0 failures
</code></pre>

<p>Current state is on Github
<a href="https://github.com/makersacademy/bookmark_manager/tree/bf1820c8e3ab276fae6e6d5be64cb2456451024c">https://github.com/makersacademy/bookmark_manager/tree/bf1820c8e3ab276fae6e6d5be64cb2456451024c</a></p>

<h3>
<a name="user-content-bookmark-manager---adding-user-accounts---three-level-of-data-checks" class="anchor" href="https://github.com/makersacademy/course/blob/master/bookmark_manager.md#bookmark-manager---adding-user-accounts---three-level-of-data-checks" aria-hidden="true"><span class="octicon octicon-link"></span></a>Bookmark manager - Adding user accounts - Three level of data checks</h3>

<p>Right now we don't do any validations except that the passwords should match. However, we shouldn't be registering the user in the first place if the email is already taken.</p>

<p>In general, there are three levels at which you can and should check for the uniqueness in a well-designed application.</p>

<p>Firstly, you should check it before the form is submitted by sending a request to the server to check if the form is valid. This is done using Javascript that we haven't covered yet, so let's ignore it for now. You can't rely exclusively on this check anyway because the form may be submitted directly without the page being rendered or javascript may be disabled.</p>

<p>You can see an example of it in action on Github if you try to create a new repository with a non-unique name.</p>

<p><a href="./course bookmark_manager.md at master · makersacademy course_files/68747470733a2f2f646368746d36723437316d75692e636c6f756466726f6e742e6e65742f6861636b7061642e636f6d5f6a75624d786442726a6e695f702e35323536375f313338303130373730383539365f53637265656e25323053686f74253230323031332d30392d3235253230617425323031322e31332e35322e706" target="_blank"><img src="./course bookmark_manager.md at master · makersacademy course_files/68747470733a2f2f646368746d36723437316d75692e636c6f756466726f6e742e6e65742f6861636b7061642e636f6d5f6a75624d786442726a6e695f702e35323536375f313338303130373730383539365f53637265656e25323053686f74253230323031332d30392d3235253230617425323031322e31332e35322e706" alt="alt text" title="bookmark manager" data-canonical-src="https://dchtm6r471mui.cloudfront.net/hackpad.com_jubMxdBrjni_p.52567_1380107708596_Screen%20Shot%202013-09-25%20at%2012.13.52.png" style="max-width:100%;"></a></p>

<p>Secondly, you should check for the uniqueness of records on the model level by using validations. This will allow you to display meaningful error messages. So, on the model level we want to have a uniqueness validation:</p>

<div class="highlight highlight-ruby"><pre><span class="n">validates_uniqueness_of</span> <span class="ss">:email</span>
</pre></div>

<p>This datamapper validation will check if a record with this email exists before trying to create a new one.</p>

<p>Finally, you should introduce database-level constraints. This is a safety check that protects the database in case any data is written directly, bypassing the model. For example, if you need to batch-add 10,000 new users from a text file, you may not want to initialise your User model for every record for performance reasons. Instead, you'll write to the database directly bypassing datamapper. To account for any cases when you may want to write to the database bypassing your models, you need to have database-level contraints.</p>

<div class="highlight highlight-ruby"><pre><span class="n">property</span> <span class="ss">:email</span><span class="p">,</span> <span class="nb">String</span><span class="p">,</span> <span class="ss">:unique</span> <span class="o">=&gt;</span> <span class="kp">true</span>
</pre></div>

<p>This will generate SQL that will create a unique index on that field.</p>

<pre><code>CREATE TABLE "users" ("id" SERIAL NOT NULL, "email" VARCHAR(50), "password_digest" TEXT, PRIMARY KEY("id"))
CREATE UNIQUE INDEX "unique_users_email" ON "users" ("email")
</code></pre>

<p>This unique index on users.email will make sure that no records with duplicate emails will ever be saved to the database.</p>

<p>In datamapper's case, creating a unique index automatically implies the necessity of the validation, so this code</p>

<div class="highlight highlight-ruby"><pre><span class="n">validates_uniqueness_of</span> <span class="ss">:email</span>
</pre></div>

<p>would be unnecessary. When using other ORMs, double check if creating a unique index implies a model-level validation.</p>

<h3>
<a name="user-content-bookmark-manager---adding-user-accounts---preventing-duplicate-registrations" class="anchor" href="https://github.com/makersacademy/course/blob/master/bookmark_manager.md#bookmark-manager---adding-user-accounts---preventing-duplicate-registrations" aria-hidden="true"><span class="octicon octicon-link"></span></a>Bookmark manager - Adding user accounts - Preventing duplicate registrations</h3>

<p>Let's write a test first, as usual, checking that we can't register the same user twice.</p>

<div class="highlight highlight-ruby"><pre>  <span class="n">scenario</span> <span class="s2">"with an email that is already registered"</span> <span class="k">do</span>
    <span class="n">expect</span><span class="p">{</span> <span class="n">sign_up</span> <span class="p">}</span><span class="o">.</span><span class="n">to</span> <span class="n">change</span><span class="p">(</span><span class="no">User</span><span class="p">,</span> <span class="ss">:count</span><span class="p">)</span><span class="o">.</span><span class="n">by</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">expect</span><span class="p">{</span> <span class="n">sign_up</span> <span class="p">}</span><span class="o">.</span><span class="n">to</span> <span class="n">change</span><span class="p">(</span><span class="no">User</span><span class="p">,</span> <span class="ss">:count</span><span class="p">)</span><span class="o">.</span><span class="n">by</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">page</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">have_content</span><span class="p">(</span><span class="s2">"This email is already taken"</span><span class="p">)</span>
  <span class="k">end</span>

</pre></div>

<p>We need to do two things. Firstly, we need to put constrains on the email field.</p>

<div class="highlight highlight-ruby"><pre><span class="n">property</span> <span class="ss">:email</span><span class="p">,</span> <span class="nb">String</span><span class="p">,</span> <span class="ss">:unique</span> <span class="o">=&gt;</span> <span class="kp">true</span><span class="p">,</span> <span class="ss">:message</span> <span class="o">=&gt;</span> <span class="s2">"This email is already taken"</span>
</pre></div>

<p>We're setting the error message datamapper is going to return explicitely even though a very similar message would be used by default if we didn't specify it.</p>

<p>Secondly, we need to refactor our controller code. Right now it looks like this.</p>

<div class="highlight highlight-ruby"><pre><span class="k">if</span> <span class="vi">@user</span><span class="o">.</span><span class="n">save</span>
  <span class="n">session</span><span class="o">[</span><span class="ss">:user_id</span><span class="o">]</span> <span class="o">=</span> <span class="vi">@user</span><span class="o">.</span><span class="n">id</span>
  <span class="n">redirect</span> <span class="n">to</span><span class="p">(</span><span class="s1">'/'</span><span class="p">)</span>
<span class="k">else</span>
  <span class="n">flash</span><span class="o">[</span><span class="ss">:notice</span><span class="o">]</span> <span class="o">=</span> <span class="s2">"Sorry, your passwords don't match"</span>
  <span class="n">erb</span> <span class="ss">:"users/new"</span>
<span class="k">end</span>
</pre></div>

<p>The problem is that the only error message that this controller can show is the one about passwords not being the same. However, we need to show various error messages and even several messages at the same time, if necessary. Let's take the list of messages from datamapper.</p>

<div class="highlight highlight-ruby"><pre><span class="k">if</span> <span class="vi">@user</span><span class="o">.</span><span class="n">save</span>
    <span class="n">session</span><span class="o">[</span><span class="ss">:user_id</span><span class="o">]</span> <span class="o">=</span> <span class="vi">@user</span><span class="o">.</span><span class="n">id</span>
    <span class="n">redirect</span> <span class="n">to</span><span class="p">(</span><span class="s1">'/'</span><span class="p">)</span>
  <span class="k">else</span>
    <span class="n">flash</span><span class="o">.</span><span class="n">now</span><span class="o">[</span><span class="ss">:errors</span><span class="o">]</span> <span class="o">=</span> <span class="vi">@user</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">full_messages</span>
    <span class="n">erb</span> <span class="ss">:"users/new"</span>
  <span class="k">end</span>
</pre></div>

<p>Note that we're switching to using flash[:errors] instead of flash[:notice]. Given that these errors prevent us from proceeding further, it's more appropriate to call them errors.</p>

<p>We're also using flash.now instead of just flash. By default, a flash message is available for both the current request and the next request. This is very convenient if we're doing a redirect. However, since we are just re-rendering the page, we just want to show the flash for the current request, not for the next one. If we use flash[:errors], then after the user fixes the mistakes, we'll be redirected to the homepage where we'll see our message again.</p>

<p>The @user.errors object contains all validation errors. It can be used to get errors for a given field (if you want to display the error next to a specific field). The full_messages method just returns an array of all errors as strings. Let's display them in our layout file.</p>

<div class="highlight highlight-html"><pre><span class="err">&lt;</span>% if flash[:errors] <span class="err">&amp;&amp;</span> !flash[:errors].empty? %&gt;
  Sorry, there were the following problems with the form.
  <span class="nt">&lt;ul</span> <span class="na">id=</span><span class="s">"errors"</span><span class="nt">&gt;</span>
    <span class="err">&lt;</span>% flash[:errors].each do |error| %&gt;
      <span class="nt">&lt;li&gt;</span><span class="err">&lt;</span>%= error %&gt;<span class="nt">&lt;/li&gt;</span>
    <span class="err">&lt;</span>% end %&gt;
  <span class="nt">&lt;/ul&gt;</span>
<span class="err">&lt;</span>% end %&gt;
</pre></div>

<p>Now we get a list of errors if the user is trying to both register with the same email and mistypes the password.</p>

<p><a href="./course bookmark_manager.md at master · makersacademy course_files/68747470733a2f2f646368746d36723437316d75692e636c6f756466726f6e742e6e65742f6861636b7061642e636f6d5f6a75624d786442726a6e695f702e35323536375f313338303131363433323733345f53637265656e25323053686f74253230323031332d30392d3235253230617425323031342e33392e35352e706" target="_blank"><img src="./course bookmark_manager.md at master · makersacademy course_files/68747470733a2f2f646368746d36723437316d75692e636c6f756466726f6e742e6e65742f6861636b7061642e636f6d5f6a75624d786442726a6e695f702e35323536375f313338303131363433323733345f53637265656e25323053686f74253230323031332d30392d3235253230617425323031342e33392e35352e706" alt="alt text" title="bookmark manager" data-canonical-src="https://dchtm6r471mui.cloudfront.net/hackpad.com_jubMxdBrjni_p.52567_1380116432734_Screen%20Shot%202013-09-25%20at%2014.39.55.png" style="max-width:100%;"></a></p>

<p>We have all the code we need to make our tests pass. (If your tests fail, the chances are the database is in an inconsistent state, see the next section).</p>

<p>Current state is on Github
<a href="https://github.com/makersacademy/bookmark_manager/tree/44a6f6d79ab74d5da01487c14ac5929349e74651">https://github.com/makersacademy/bookmark_manager/tree/44a6f6d79ab74d5da01487c14ac5929349e74651</a></p>

<h3>
<a name="user-content-bookmark-manager---adding-user-accounts---rake-tasks-for-database-management" class="anchor" href="https://github.com/makersacademy/course/blob/master/bookmark_manager.md#bookmark-manager---adding-user-accounts---rake-tasks-for-database-management" aria-hidden="true"><span class="octicon octicon-link"></span></a>Bookmark manager - Adding user accounts - Rake tasks for database management</h3>

<p>Since we are changing the schema of the database in a destructive way (creating a unique index), we need to execute <code>DataMapper.auto_migrate!</code> instead of <code>DataMapper.auto_upgrade!</code> after we create a unique index.</p>

<p>Right now our <code>data_upgrade!</code> call is in <code>data_mapper_setup</code> but this creates two problems. First, we don't want to edit this file every time we want to run <code>data_migrate!</code> instead. Second, we don't want to run <code>data_upgrade</code> every single time we respond to a request. Let's create a rake task for these operations, so that we could call them manually when we need to.</p>

<p>Rake is a tool for running automated tasks. The tasks are defined in <code>Rakefile</code> (with capital R). Put this Rakefile in the root folder of the project.</p>

<div class="highlight highlight-ruby"><pre><span class="nb">require</span> <span class="s1">'data_mapper'</span>
<span class="nb">require</span> <span class="s1">'./app/data_mapper_setup'</span>

<span class="n">task</span> <span class="ss">:auto_upgrade</span> <span class="k">do</span>
  <span class="c1"># auto_upgrade makes non-destructive changes.</span>
  <span class="c1"># If your tables don't exist, they will be created</span>
  <span class="c1"># but if they do and you changed your schema</span>
  <span class="c1"># (e.g. changed the type of one of the properties)</span>
  <span class="c1"># they will not be upgraded because that'd lead to data loss.</span>
  <span class="no">DataMapper</span><span class="o">.</span><span class="n">auto_upgrade!</span>
  <span class="nb">puts</span> <span class="s2">"Auto-upgrade complete (no data loss)"</span>
<span class="k">end</span>

<span class="n">task</span> <span class="ss">:auto_migrate</span> <span class="k">do</span>
  <span class="c1"># To force the creation of all tables as they are</span>
  <span class="c1"># described in your models, even if this</span>
  <span class="c1"># may lead to data loss, use auto_migrate:</span>
  <span class="no">DataMapper</span><span class="o">.</span><span class="n">auto_migrate!</span>
  <span class="nb">puts</span> <span class="s2">"Auto-migrate complete (data could have been lost)"</span>
<span class="k">end</span>
<span class="c1"># Finally, don't forget that before you do any of that stuff,</span>
<span class="c1"># you need to create a database first.</span>
</pre></div>

<p>The syntax should be self-explanatory. We define two tasks: "auto_migrate" and "auto_upgrade". Whenever we want to run any of them, we just invoke rake from the command line:</p>

<pre><code>$ rake auto_migrate
</code></pre>

<p>This way you can upgrade or migrate your database manually after every change to the model. Ruby on Rails makes extensive use of Rake tasks, as we'll see later.</p>

<p>Current state is on Github
<a href="https://github.com/makersacademy/bookmark_manager/tree/a97fbdb0d12210277d6dca158b03ce6c88d07677">https://github.com/makersacademy/bookmark_manager/tree/a97fbdb0d12210277d6dca158b03ce6c88d07677</a></p>

<h3>
<a name="user-content-bookmark-manager---adding-user-accounts---signing-in" class="anchor" href="https://github.com/makersacademy/course/blob/master/bookmark_manager.md#bookmark-manager---adding-user-accounts---signing-in" aria-hidden="true"><span class="octicon octicon-link"></span></a>Bookmark manager - Adding user accounts - Signing in</h3>

<p>The users can sign up on our website but there's no way to sign in if you happen to be logged out (not that we have logging out functionality yet but it's coming). Let's write a test for signing in.</p>

<div class="highlight highlight-ruby"><pre><span class="n">feature</span> <span class="s2">"User signs in"</span> <span class="k">do</span>

  <span class="n">before</span><span class="p">(</span><span class="ss">:each</span><span class="p">)</span> <span class="k">do</span>
    <span class="no">User</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="ss">:email</span> <span class="o">=&gt;</span> <span class="s2">"test@test.com"</span><span class="p">,</span>
                <span class="ss">:password</span> <span class="o">=&gt;</span> <span class="s1">'test'</span><span class="p">,</span>
                <span class="ss">:password_confirmation</span> <span class="o">=&gt;</span> <span class="s1">'test'</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="n">scenario</span> <span class="s2">"with correct credentials"</span> <span class="k">do</span>
    <span class="n">visit</span> <span class="s1">'/'</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">page</span><span class="p">)</span><span class="o">.</span><span class="n">not_to</span> <span class="n">have_content</span><span class="p">(</span><span class="s2">"Welcome, test@test.com"</span><span class="p">)</span>
    <span class="n">sign_in</span><span class="p">(</span><span class="s1">'test@test.com'</span><span class="p">,</span> <span class="s1">'test'</span><span class="p">)</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">page</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">have_content</span><span class="p">(</span><span class="s2">"Welcome, test@test.com"</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="n">scenario</span> <span class="s2">"with incorrect credentials"</span> <span class="k">do</span>
    <span class="n">visit</span> <span class="s1">'/'</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">page</span><span class="p">)</span><span class="o">.</span><span class="n">not_to</span> <span class="n">have_content</span><span class="p">(</span><span class="s2">"Welcome, test@test.com"</span><span class="p">)</span>
    <span class="n">sign_in</span><span class="p">(</span><span class="s1">'test@test.com'</span><span class="p">,</span> <span class="s1">'wrong'</span><span class="p">)</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">page</span><span class="p">)</span><span class="o">.</span><span class="n">not_to</span> <span class="n">have_content</span><span class="p">(</span><span class="s2">"Welcome, test@test.com"</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">sign_in</span><span class="p">(</span><span class="n">email</span><span class="p">,</span> <span class="n">password</span><span class="p">)</span>
    <span class="n">visit</span> <span class="s1">'/sessions/new'</span>
    <span class="n">fill_in</span> <span class="s1">'email'</span><span class="p">,</span> <span class="ss">:with</span> <span class="o">=&gt;</span> <span class="n">email</span>
    <span class="n">fill_in</span> <span class="s1">'password'</span><span class="p">,</span> <span class="ss">:with</span> <span class="o">=&gt;</span> <span class="n">password</span>
    <span class="n">click_button</span> <span class="s1">'Sign in'</span>
  <span class="k">end</span>

<span class="k">end</span>
</pre></div>

<p>The only interesting part in this test is line 24. Why do we want to sign_in at "/sessions/new", and not at "/sign_in", "/users/sign_in", "/login" or something like this? Technically, it would work but it wouldn't be as elegant.</p>

<p>When signing in or out, we are manipulating a session: creating it, destroying it, and displaying a form to create it. By creating urls that define actions that apply to resources, we will achieve more elegant and easy to understand urls. Compare this</p>

<pre><code>/users/new
/users
/users/edit
/sessions/new
/sessions
</code></pre>

<p>to this</p>

<pre><code>
/create_user_form
/create_user
/edit_user_form
/edit_user
/sign_in_form
/sign_in
/logout
</code></pre>

<p>The first approach is far more elegant. We've barely touched how urls should be defined (it's a slightly larger topic) but we'll go into details in Routing and REST.</p>

<p>To make this work, we'll need a form in sessions/new</p>

<div class="highlight highlight-html"><pre>Please sign in.

<span class="nt">&lt;form</span> <span class="na">method=</span><span class="s">"post"</span> <span class="na">action=</span><span class="s">"/sessions"</span><span class="nt">&gt;</span>
  Email: <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">name=</span><span class="s">'email'</span><span class="nt">&gt;</span>
  Password: <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"password"</span> <span class="na">name=</span><span class="s">'password'</span><span class="nt">&gt;</span>
  <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"submit"</span> <span class="na">value=</span><span class="s">"Sign in"</span><span class="nt">&gt;</span>
<span class="nt">&lt;/form&gt;</span>
</pre></div>

<p>a method to show this form:</p>

<div class="highlight highlight-ruby"><pre><span class="n">get</span> <span class="s1">'/sessions/new'</span> <span class="k">do</span>
  <span class="n">erb</span> <span class="ss">:"sessions/new"</span>
<span class="k">end</span>
</pre></div>

<p>a method to handle form submission</p>

<div class="highlight highlight-ruby"><pre><span class="n">post</span> <span class="s1">'/sessions'</span> <span class="k">do</span>
  <span class="n">email</span><span class="p">,</span> <span class="n">password</span> <span class="o">=</span> <span class="n">params</span><span class="o">[</span><span class="ss">:email</span><span class="o">]</span><span class="p">,</span> <span class="n">params</span><span class="o">[</span><span class="ss">:password</span><span class="o">]</span>
  <span class="n">user</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">authenticate</span><span class="p">(</span><span class="n">email</span><span class="p">,</span> <span class="n">password</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">user</span>
    <span class="n">session</span><span class="o">[</span><span class="ss">:user_id</span><span class="o">]</span> <span class="o">=</span> <span class="n">user</span><span class="o">.</span><span class="n">id</span>
    <span class="n">redirect</span> <span class="n">to</span><span class="p">(</span><span class="s1">'/'</span><span class="p">)</span>
  <span class="k">else</span>
    <span class="n">flash</span><span class="o">[</span><span class="ss">:errors</span><span class="o">]</span> <span class="o">=</span> <span class="o">[</span><span class="s2">"The email or password is incorrect"</span><span class="o">]</span>
    <span class="n">erb</span> <span class="ss">:"sessions/new"</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>

<p>and the User.authenticate method that we'll get to in a second.</p>

<p>Note that we're using the same pattern we used before: we try to obtain the user object by authenticating using the email and password provided and then check if we got one. If we did, we sign the user in and redirect. If we didn't, we show an error and display the form again.</p>

<p>Finally, we need a class method to authenticate a user.</p>

<div class="highlight highlight-ruby"><pre><span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">authenticate</span><span class="p">(</span><span class="n">email</span><span class="p">,</span> <span class="n">password</span><span class="p">)</span>
  <span class="c1"># that's the user who is trying to sign in</span>
  <span class="n">user</span> <span class="o">=</span> <span class="n">first</span><span class="p">(</span><span class="ss">:email</span> <span class="o">=&gt;</span> <span class="n">email</span><span class="p">)</span>
  <span class="c1"># if this user exists and the password provided matches</span>
  <span class="c1"># the one we have password_digest for, everything's fine</span>
  <span class="c1">#</span>
  <span class="c1"># The Password.new returns an object that overrides the ==</span>
  <span class="c1"># method. Instead of comparing two passwords directly</span>
  <span class="c1"># (which is impossible because we only have a one-way hash)</span>
  <span class="c1"># the == method calculates the candidate password_digest from</span>
  <span class="c1"># the password given and compares it to the password_digest</span>
  <span class="c1"># it was initialised with.</span>
  <span class="c1"># So, to recap: THIS IS NOT A STRING COMPARISON</span>
  <span class="k">if</span> <span class="n">user</span> <span class="o">&amp;&amp;</span> <span class="no">BCrypt</span><span class="o">::</span><span class="no">Password</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">password_digest</span><span class="p">)</span> <span class="o">==</span> <span class="n">password</span>
    <span class="c1"># return this user</span>
    <span class="n">user</span>
  <span class="k">else</span>
    <span class="kp">nil</span>
  <span class="k">end</span>
<span class="k">end</span>

</pre></div>

<p>Since we're using bcrypt to generate a one-way hash, we cannot compare the passwords directly. We genuinely have no way of recovering the actual password. It is lost forever. However, what we do have is a digest that we can use to check if the password the user is trying to log in with is correct.</p>

<p>So we pass the password that the user is trying to log in with to the == method of the Password class. That method then calculates the digest for that password and compares it to the one in the database. It could look like this (not real bcrypt code):</p>

<div class="highlight highlight-ruby"><pre><span class="k">module</span> <span class="nn">BCrypt</span>
  <span class="k">class</span> <span class="nc">Password</span>
    <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">digest</span><span class="p">)</span>
        <span class="vi">@digest</span> <span class="o">=</span> <span class="n">digest</span>
    <span class="k">end</span>
    <span class="k">def</span> <span class="nf">==</span><span class="p">(</span><span class="n">password</span><span class="p">)</span>
        <span class="vi">@digest</span> <span class="o">==</span> <span class="n">digest</span><span class="p">(</span><span class="n">salt</span><span class="p">(</span><span class="vi">@digest</span><span class="p">),</span> <span class="n">password</span><span class="p">)</span>
    <span class="k">end</span>
    <span class="k">def</span> <span class="nf">digest</span><span class="p">(</span><span class="n">salt</span><span class="p">,</span> <span class="n">password</span><span class="p">)</span>
        <span class="c1"># compute the digest</span>
        <span class="c1"># by using bcrypt magic.</span>
        <span class="c1"># return something like</span>
        <span class="c1"># "$2a$10$vI8aWBnW3fID.ZQ4/zo1G.q1lRps.9cGLcZEiGDMVr5yKUOYTa"</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>

<p>Current state is on Github
<a href="https://github.com/makersacademy/bookmark_manager/tree/3beb8ac44357ceedf643bcbc9fccd92459faa92d">https://github.com/makersacademy/bookmark_manager/tree/3beb8ac44357ceedf643bcbc9fccd92459faa92d</a></p>

<h3>
<a name="user-content-bookmark-manager---adding-user-accounts---signing-out" class="anchor" href="https://github.com/makersacademy/course/blob/master/bookmark_manager.md#bookmark-manager---adding-user-accounts---signing-out" aria-hidden="true"><span class="octicon octicon-link"></span></a>Bookmark manager - Adding user accounts - Signing out</h3>

<p>So far we learned how to create the users and sign them in. Let's see how we can log them out.</p>

<p>Since "signed in" only means that there's a user_id in the session, logging the user out is as simple as setting the session[:user_id] to nil. Let's write a test.</p>

<div class="highlight highlight-ruby"><pre><span class="n">feature</span> <span class="s1">'User signs out'</span> <span class="k">do</span>

  <span class="n">before</span><span class="p">(</span><span class="ss">:each</span><span class="p">)</span> <span class="k">do</span>
    <span class="no">User</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="ss">:email</span> <span class="o">=&gt;</span> <span class="s2">"test@test.com"</span><span class="p">,</span>
                <span class="ss">:password</span> <span class="o">=&gt;</span> <span class="s1">'test'</span><span class="p">,</span>
                <span class="ss">:password_confirmation</span> <span class="o">=&gt;</span> <span class="s1">'test'</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="n">scenario</span> <span class="s1">'while being signed in'</span> <span class="k">do</span>
    <span class="n">sign_in</span><span class="p">(</span><span class="s1">'test@test.com'</span><span class="p">,</span> <span class="s1">'test'</span><span class="p">)</span>
    <span class="n">click_button</span> <span class="s2">"Sign out"</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">page</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">have_content</span><span class="p">(</span><span class="s2">"Good bye!"</span><span class="p">)</span> <span class="c1"># where does this message go?</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">page</span><span class="p">)</span><span class="o">.</span><span class="n">not_to</span> <span class="n">have_content</span><span class="p">(</span><span class="s2">"Welcome, test@test.com"</span><span class="p">)</span>
  <span class="k">end</span>

<span class="k">end</span>
</pre></div>

<p>Since the sign_in helper is now used for more than one feature (sign in and sign out), let's extract it into an separate helper and include it as a module:</p>

<div class="highlight highlight-ruby"><pre><span class="n">require_relative</span> <span class="s1">'helpers/session'</span>

<span class="kp">include</span> <span class="no">SessionHelpers</span>
</pre></div>

<p>The module now contains the methods sign_in and sign_up that we used to have in user_management_spec.</p>

<p>We will now need to display the Sign Out button that the test expects. The layout is a good place to do it since we'll need it on all pages of our site.</p>

<div class="highlight highlight-html"><pre>  <span class="err">&lt;</span>% if current_user %&gt;
    Welcome, <span class="err">&lt;</span>%= current_user.email %&gt;
    <span class="nt">&lt;form</span> <span class="na">method=</span><span class="s">"post"</span> <span class="na">action=</span><span class="s">"/sessions"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"hidden"</span> <span class="na">name=</span><span class="s">"_method"</span> <span class="na">value=</span><span class="s">"delete"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"submit"</span> <span class="na">value=</span><span class="s">"Sign out"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;/form&gt;</span>
  <span class="err">&lt;</span>% end %&gt;

</pre></div>

<p>The form sends a POST request to /sessions but it also includes a hidden field _method (note the underscore) with value "delete". The reason is that the common convention for a url that destroys a resource is sending a DELETE request to /resource_url. However, modern browsers are unable to send any requests other than GET or POST when the form is being submitted. A common solution to this problem, used by both Sinatra and Ruby on Rails, is to include a hidden field called _method that will override the actual type of request. So, when Sinatra receives this request, it will behave as if it were a DELETE request and not a POST request. Therefore, the handler for this form needs to specify "delete" as an HTTP verb:</p>

<p>Finally, let's add support for flash[:notice] in our layout.</p>

<div class="highlight highlight-html"><pre>  <span class="err">&lt;</span>% if flash[:notice] %&gt;
    <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"notice"</span><span class="nt">&gt;</span>
      <span class="err">&lt;</span>%= flash[:notice] %&gt;
    <span class="nt">&lt;/div&gt;</span>
  <span class="err">&lt;</span>% end %&gt;
</pre></div>

<p>The tests pass, so we know that the user can now be signed out.</p>

<p>Now it's a good time to refactor our code a little bit. Let's install 'sinatra-partial' gem and use it like we did in BattleShip – web version to extract the welcome message and flash from the layout. Let's also extract all actions from server.rb into specific controllers in the /app/controllers folder. After we do this, our server.rb is nice and clean, containing only require statements and high-level configuration. Let's also move the models from /lib to /app/models to make sure that the models, views and controllers are in one place (incidentally, we're following Ruby on Rails naming conventions to some extent).</p>

<p>Current state is on Github
<a href="https://github.com/makersacademy/bookmark_manager/tree/2e09228d334fd8009296653dfd55768520734654">https://github.com/makersacademy/bookmark_manager/tree/2e09228d334fd8009296653dfd55768520734654</a></p>

<h3>
<a name="user-content-bookmark-manager---adding-user-accounts---forgotten-password" class="anchor" href="https://github.com/makersacademy/course/blob/master/bookmark_manager.md#bookmark-manager---adding-user-accounts---forgotten-password" aria-hidden="true"><span class="octicon octicon-link"></span></a>Bookmark manager - Adding user accounts - Forgotten password</h3>

<p>Instead of implementing it, let's just discuss how it could be done since it's fairly straightforward.</p>

<p>If a user forgets the password, we cannot just send it by email for two reasons. Firstly, we don't know the password: we only have the digest. Secondly, that would be insecure because the password would likely be stored in the email archive. If the email archive is compromised, then the attacker would know the password.</p>

<p>Instead of sending the password, we need to send a one-time password recovery token. It's a long random string that can be used only once and only for a limited time to change the password. The flow is as follows:</p>

<ul class="task-list">
<li>Create a form that can be used to request a new password. The only field you need is email.</li>
<li>Find the record of the user that's recovering the password.</li>
<li>Generate a long, random password recovery token and save it as part of the user record, together with a timestamp.</li>
</ul><div class="highlight highlight-ruby"><pre><span class="n">user</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">first</span><span class="p">(</span><span class="ss">:email</span> <span class="o">=&gt;</span> <span class="n">email</span><span class="p">)</span>
<span class="c1"># avoid having to memorise ascii codes</span>
<span class="n">user</span><span class="o">.</span><span class="n">password_token</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">.</span><span class="n">.</span><span class="mi">64</span><span class="p">)</span><span class="o">.</span><span class="n">map</span><span class="p">{(</span><span class="s1">'A'</span><span class="o">.</span><span class="n">.</span><span class="s1">'Z'</span><span class="p">)</span><span class="o">.</span><span class="n">to_a</span><span class="o">.</span><span class="n">sample</span><span class="p">}</span><span class="o">.</span><span class="n">join</span>
<span class="n">user</span><span class="o">.</span><span class="n">password_token_timestamp</span> <span class="o">=</span> <span class="no">Time</span><span class="o">.</span><span class="n">now</span>
<span class="n">user</span><span class="o">.</span><span class="n">save</span>
</pre></div>

<ul class="task-list">
<li>Create a route to reset the password: get "/users/reset_password/:token"</li>
<li>Send an email with this a link containing this token to the user.</li>
<li>When the link is clicked, find the user that has this token in the database.</li>
</ul><div class="highlight highlight-ruby"><pre><span class="n">user</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">first</span><span class="p">(</span><span class="ss">:password_token</span> <span class="o">=&gt;</span> <span class="n">token</span><span class="p">)</span>
</pre></div>

<p>*Check that the token was issued recently (a hour, maybe, or less) and if so, allow the user to set a new password (this will require a new form and a new route to handle it. The token must be a hidden field on the form and it must be checked again after submission. Finally, after the new password is set, remove the token from the database, so that it couldn't be used again.</p>

<h3>
<a name="user-content-sending-the-email" class="anchor" href="https://github.com/makersacademy/course/blob/master/bookmark_manager.md#sending-the-email" aria-hidden="true"><span class="octicon octicon-link"></span></a>Sending the email</h3>

<p>To send an email, you will need an external SMTP server that will do it for you. There are several companies provided these services: Mailgun and Sendgrid are among the most popular. They are also available as add-ons on Heroku, making the integration into your application trivial. Let's consider how we could use Mailgun to send emails.</p>

<p>First, you'll need to add the addon to heroku. This will make the API key that you need to send an email available in your env variables (you can read them by typing "heroku config" in the project folder).</p>

<p>Sending the email is as easy as sending a POST request from your app. To send an HTTP request, you'll need one of the many available libraries (HTTParty, Net::HTTP, RestClient, etc). The following example is taken from the Mailgun quickstart guide. It uses RestClient.</p>

<div class="highlight highlight-ruby"><pre><span class="k">def</span> <span class="nf">send_simple_message</span>
  <span class="no">RestClient</span><span class="o">.</span><span class="n">post</span> <span class="s2">"https://api:key-3ax6xnjp29jd6fds4gc373sgvjxteol0"</span><span class="p">\</span>
  <span class="s2">"@api.mailgun.net/v2/samples.mailgun.org/messages"</span><span class="p">,</span>
  <span class="ss">:from</span> <span class="o">=&gt;</span> <span class="s2">"Excited User &lt;me@samples.mailgun.org&gt;"</span><span class="p">,</span>
  <span class="ss">:to</span> <span class="o">=&gt;</span> <span class="s2">"bar@example.com, baz@example.com"</span><span class="p">,</span>
  <span class="ss">:subject</span> <span class="o">=&gt;</span> <span class="s2">"Hello"</span><span class="p">,</span>
  <span class="ss">:text</span> <span class="o">=&gt;</span> <span class="s2">"Testing some Mailgun awesomness!"</span>
<span class="k">end</span>
</pre></div>

<p>To test it locally it may be convenient to add the addon to Heroku to generate and API key and then create an environment variable in your .bash_profile to make it available locally.</p>

<h2>
<a name="user-content-styling-the-website" class="anchor" href="https://github.com/makersacademy/course/blob/master/bookmark_manager.md#styling-the-website" aria-hidden="true"><span class="octicon octicon-link"></span></a>Styling the website</h2>

<p>Right now our Bookmark Manager is very basic. Let's make it a bit more beautiful. We could have user powerful frameworks like Twitter Bootstrap that would have made our task easier but for the sake of practicing working with raw HTML/CSS, let's not use them.</p>

<p>Normally, as a developer, you'd get wireframes from a designer or take an off-the-shelf theme but our objective in this lesson is to learn how to write HTML&amp;CSS from scratch.</p>

<p>In this section I will sometimes omit non-essential CSS&amp;HTML examples focusing on more interesting aspects of front-end technologies instead.</p>

<p>As with Ruby code, you're strongly encouraged to use the code provided only as a reference to understand how it works. Write your own HTML and CSS code by hand, googling every new HTML tag and CSS property you encounter.</p>

<p>This is our starting point. There is no styling except the background colour.</p>

<p><a href="./course bookmark_manager.md at master · makersacademy course_files/68747470733a2f2f646368746d36723437316d75692e636c6f756466726f6e742e6e65742f6861636b7061642e636f6d5f48726d4c72614a636c6c795f702e35323536375f313338303230303435323436375f53637265656e25323053686f74253230323031332d30392d3236253230617425323031342e30302e32392e706" target="_blank"><img src="./course bookmark_manager.md at master · makersacademy course_files/68747470733a2f2f646368746d36723437316d75692e636c6f756466726f6e742e6e65742f6861636b7061642e636f6d5f48726d4c72614a636c6c795f702e35323536375f313338303230303435323436375f53637265656e25323053686f74253230323031332d30392d3236253230617425323031342e30302e32392e706" alt="alt text" title="styling" data-canonical-src="https://dchtm6r471mui.cloudfront.net/hackpad.com_HrmLraJclly_p.52567_1380200452467_Screen%20Shot%202013-09-26%20at%2014.00.29.png" style="max-width:100%;"></a></p>

<p>First, add a css reset file to your project. You can get one from <a href="http://www.cssreset.com/">www.cssreset.com</a>. The goal of this file is to define the look of the elements that we didn't write CSS for. The reason CSS reset is necessary is that every browser uses its own defaults, so if you don't specify some property, your CSS may look slightly different in different browsers.</p>

<p>After we add Eric Meyer's CSS reset, our page looks very different.</p>

<p><a href="./course bookmark_manager.md at master · makersacademy course_files/68747470733a2f2f646368746d36723437316d75692e636c6f756466726f6e742e6e65742f6861636b7061642e636f6d5f48726d4c72614a636c6c795f702e35323536375f313338303230313534373336395f53637265656e25323053686f74253230323031332d30392d3236253230617425323031342e31382e35332e706" target="_blank"><img src="./course bookmark_manager.md at master · makersacademy course_files/68747470733a2f2f646368746d36723437316d75692e636c6f756466726f6e742e6e65742f6861636b7061642e636f6d5f48726d4c72614a636c6c795f702e35323536375f313338303230313534373336395f53637265656e25323053686f74253230323031332d30392d3236253230617425323031342e31382e35332e706" alt="alt text" title="styling" data-canonical-src="https://dchtm6r471mui.cloudfront.net/hackpad.com_HrmLraJclly_p.52567_1380201547369_Screen%20Shot%202013-09-26%20at%2014.18.53.png" style="max-width:100%;"></a></p>

<h2>
<a name="user-content-front-page" class="anchor" href="https://github.com/makersacademy/course/blob/master/bookmark_manager.md#front-page" aria-hidden="true"><span class="octicon octicon-link"></span></a>Front page</h2>

<p>Let's start by creating a black header line that will have the logo and the sign-in / sign-up / sign-out buttons. We're will be giving most elements an id or class to refer to the in the CSS file. The welcome message is a span because it doesn't need the dimensions, so we can use an inline element.</p>

<div class="highlight highlight-ruby"><pre><span class="o">&lt;</span><span class="n">header</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">div</span> <span class="nb">id</span><span class="o">=</span><span class="s2">"logo"</span><span class="o">&gt;</span><span class="no">Bookmark</span> <span class="no">Manager</span><span class="o">&lt;</span><span class="sr">/div&gt;</span>
<span class="sr">  &lt;div id="user-links"&gt;</span>
<span class="sr">    &lt;% if current_user %&gt;</span>
<span class="sr">      &lt;span id="welcome-message"&gt;</span>
<span class="sr">        Welcome, &lt;%= current_user.email %&gt;</span>
<span class="sr">      &lt;/s</span><span class="n">pan</span><span class="o">&gt;</span>

      <span class="o">&lt;</span><span class="n">form</span> <span class="nb">id</span><span class="o">=</span><span class="s2">"sign-out"</span> <span class="nb">method</span><span class="o">=</span><span class="s2">"post"</span> <span class="n">action</span><span class="o">=</span><span class="s2">"/sessions"</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="n">input</span> <span class="n">type</span><span class="o">=</span><span class="s2">"hidden"</span> <span class="nb">name</span><span class="o">=</span><span class="s2">"_method"</span> <span class="n">value</span><span class="o">=</span><span class="s2">"delete"</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="n">input</span> <span class="n">type</span><span class="o">=</span><span class="s2">"submit"</span> <span class="n">value</span><span class="o">=</span><span class="s2">"Sign out"</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="sr">/form&gt;</span>
<span class="sr">  &lt;/</span><span class="n">div</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="sr">/header&gt;</span>
</pre></div>

<p><a href="./course bookmark_manager.md at master · makersacademy course_files/68747470733a2f2f646368746d36723437316d75692e636c6f756466726f6e742e6e65742f6861636b7061642e636f6d5f48726d4c72614a636c6c795f702e35323536375f313338303230313839303038395f53637265656e25323053686f74253230323031332d30392d3236253230617425323031342e32342e34352e706" target="_blank"><img src="./course bookmark_manager.md at master · makersacademy course_files/68747470733a2f2f646368746d36723437316d75692e636c6f756466726f6e742e6e65742f6861636b7061642e636f6d5f48726d4c72614a636c6c795f702e35323536375f313338303230313839303038395f53637265656e25323053686f74253230323031332d30392d3236253230617425323031342e32342e34352e706" alt="alt text" data-canonical-src="https://dchtm6r471mui.cloudfront.net/hackpad.com_HrmLraJclly_p.52567_1380201890089_Screen%20Shot%202013-09-26%20at%2014.24.45.png" style="max-width:100%;"></a></p>

<p>github
<a href="https://github.com/makersacademy/bookmark_manager/tree/8dde272fc5957bff09d196d6ec56d1278aa0c7c9">https://github.com/makersacademy/bookmark_manager/tree/8dde272fc5957bff09d196d6ec56d1278aa0c7c9</a></p>

<p>Let's now add sign up and sign in buttons.</p>

<p><a href="./course bookmark_manager.md at master · makersacademy course_files/68747470733a2f2f646368746d36723437316d75692e636c6f756466726f6e742e6e65742f6861636b7061642e636f6d5f48726d4c72614a636c6c795f702e35323536375f313338303230333138393237325f53637265656e25323053686f74253230323031332d30392d3236253230617425323031342e34362e31322e706" target="_blank"><img src="./course bookmark_manager.md at master · makersacademy course_files/68747470733a2f2f646368746d36723437316d75692e636c6f756466726f6e742e6e65742f6861636b7061642e636f6d5f48726d4c72614a636c6c795f702e35323536375f313338303230333138393237325f53637265656e25323053686f74253230323031332d30392d3236253230617425323031342e34362e31322e706" alt="alt text" data-canonical-src="https://dchtm6r471mui.cloudfront.net/hackpad.com_HrmLraJclly_p.52567_1380203189272_Screen%20Shot%202013-09-26%20at%2014.46.12.png" style="max-width:100%;"></a></p>

<p>github
<a href="https://github.com/makersacademy/bookmark_manager/tree/c61d9bb8c2516207c1bd16c26c2d4ca367135bfe">https://github.com/makersacademy/bookmark_manager/tree/c61d9bb8c2516207c1bd16c26c2d4ca367135bfe</a></p>

<p>Let's add some subtle texture to the background. The Extra Clean Paper on Subtle Patterns looks nice.</p>

<p><a href="./course bookmark_manager.md at master · makersacademy course_files/68747470733a2f2f646368746d36723437316d75692e636c6f756466726f6e742e6e65742f6861636b7061642e636f6d5f48726d4c72614a636c6c795f702e35323536375f313338303230343231323139315f53637265656e25323053686f74253230323031332d30392d3236253230617425323031352e30332e32372e706" target="_blank"><img src="./course bookmark_manager.md at master · makersacademy course_files/68747470733a2f2f646368746d36723437316d75692e636c6f756466726f6e742e6e65742f6861636b7061642e636f6d5f48726d4c72614a636c6c795f702e35323536375f313338303230343231323139315f53637265656e25323053686f74253230323031332d30392d3236253230617425323031352e30332e32372e706" alt="alt text" data-canonical-src="https://dchtm6r471mui.cloudfront.net/hackpad.com_HrmLraJclly_p.52567_1380204212191_Screen%20Shot%202013-09-26%20at%2015.03.27.png" style="max-width:100%;"></a></p>

<p>github
<a href="https://github.com/makersacademy/bookmark_manager/tree/94ff132a390afb6bc9e3bfffeb118f737bb64da9">https://github.com/makersacademy/bookmark_manager/tree/94ff132a390afb6bc9e3bfffeb118f737bb64da9</a></p>

<p>Let's now extract the form to add a link to its own page. To do this we need to create a new view, /links/new.erb, a new route in links.rb and update the tests that were expecting the form to be on the frontpage.</p>

<p><a href="./course bookmark_manager.md at master · makersacademy course_files/68747470733a2f2f646368746d36723437316d75692e636c6f756466726f6e742e6e65742f6861636b7061642e636f6d5f48726d4c72614a636c6c795f702e35323536375f313338303230343536343535325f53637265656e25323053686f74253230323031332d30392d3236253230617425323031352e30392e31392e706" target="_blank"><img src="./course bookmark_manager.md at master · makersacademy course_files/68747470733a2f2f646368746d36723437316d75692e636c6f756466726f6e742e6e65742f6861636b7061642e636f6d5f48726d4c72614a636c6c795f702e35323536375f313338303230343536343535325f53637265656e25323053686f74253230323031332d30392d3236253230617425323031352e30392e31392e706" alt="alt text" data-canonical-src="https://dchtm6r471mui.cloudfront.net/hackpad.com_HrmLraJclly_p.52567_1380204564552_Screen%20Shot%202013-09-26%20at%2015.09.19.png" style="max-width:100%;"></a></p>

<p><a href="./course bookmark_manager.md at master · makersacademy course_files/68747470733a2f2f646368746d36723437316d75692e636c6f756466726f6e742e6e65742f6861636b7061642e636f6d5f48726d4c72614a636c6c795f702e35323536375f313338303230343538343536355f53637265656e25323053686f74253230323031332d30392d3236253230617425323031352e30392e33392e706" target="_blank"><img src="./course bookmark_manager.md at master · makersacademy course_files/68747470733a2f2f646368746d36723437316d75692e636c6f756466726f6e742e6e65742f6861636b7061642e636f6d5f48726d4c72614a636c6c795f702e35323536375f313338303230343538343536355f53637265656e25323053686f74253230323031332d30392d3236253230617425323031352e30392e33392e706" alt="alt text" data-canonical-src="https://dchtm6r471mui.cloudfront.net/hackpad.com_HrmLraJclly_p.52567_1380204584565_Screen%20Shot%202013-09-26%20at%2015.09.39.png" style="max-width:100%;"></a></p>

<p>github
<a href="https://github.com/makersacademy/bookmark_manager/tree/3f393ebd1c36c290cc545f7d1c55012aba307c6d">https://github.com/makersacademy/bookmark_manager/tree/3f393ebd1c36c290cc545f7d1c55012aba307c6d</a></p>

<p>The logo of the website is usually a link to the frontpage. Let's make it a link by wrapping the text in the anchor element. We'll need to update our css to specify that all links in the header are white and have no text-decoration (by default, links are underlined).</p>

<p>It's also a good time to get rid of the "Welcome to the bookmark manager" message.</p>

<p>Let's now add a button to submit a new link to the header. We already have a route for it, /links/new, so it will simply be a link between #logo and #user-links.</p>

<div class="highlight highlight-html"><pre><span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"/links/new"</span> <span class="na">class=</span><span class="s">"button highlighted"</span><span class="nt">&gt;</span>Add link<span class="nt">&lt;/a&gt;</span>
</pre></div>

<p>This link has two classes, though. It's a button because we want it to look like a button but we give it a different class to override background colour.</p>

<div class="highlight highlight-css"><pre><span class="c">/* a link that has both classes. Overrides the previous declaration*/</span>
<span class="nt">a</span><span class="nc">.button.highlighted</span> <span class="p">{</span>
  <span class="k">background-color</span><span class="o">:</span> <span class="m">#b77843</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

<p>Now we have a button that's slightly different from the default button. The space between the logo and the button is explained by the margin-right on the logo.</p>

<p><a href="./course bookmark_manager.md at master · makersacademy course_files/68747470733a2f2f646368746d36723437316d75692e636c6f756466726f6e742e6e65742f6861636b7061642e636f6d5f48726d4c72614a636c6c795f702e35323536375f313338303230353338333833375f53637265656e25323053686f74253230323031332d30392d3236253230617425323031352e32322e35382e706" target="_blank"><img src="./course bookmark_manager.md at master · makersacademy course_files/68747470733a2f2f646368746d36723437316d75692e636c6f756466726f6e742e6e65742f6861636b7061642e636f6d5f48726d4c72614a636c6c795f702e35323536375f313338303230353338333833375f53637265656e25323053686f74253230323031332d30392d3236253230617425323031352e32322e35382e706" alt="alt text" data-canonical-src="https://dchtm6r471mui.cloudfront.net/hackpad.com_HrmLraJclly_p.52567_1380205383837_Screen%20Shot%202013-09-26%20at%2015.22.58.png" style="max-width:100%;"></a></p>

<p>The colour was chosen using Colorhexa. It can generate colour schemes: sets of colours that arguably go together. If you're can't tell what colours go together (I'm like this), use colour scheme generators.</p>

<p>Note that I added a couple more links to the database.</p>

<p>github
<a href="https://github.com/makersacademy/bookmark_manager/tree/7baae00b00b55846c4a4618c337c202523315879">https://github.com/makersacademy/bookmark_manager/tree/7baae00b00b55846c4a4618c337c202523315879</a></p>

<p>Let's now style the links list. First, let's put them into a container and move the link itself into a partial (remember partials from BattleShip – web version?). This will allow us to style the container itself.</p>

<div class="highlight highlight-html"><pre><span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">'links-container'</span><span class="nt">&gt;</span>
  <span class="nt">&lt;ul</span> <span class="na">id=</span><span class="s">'links'</span><span class="nt">&gt;</span>
    <span class="err">&lt;</span>% @links.each do |link| %&gt;
      <span class="err">&lt;</span>%= partial :link, :locals =&gt; {:link =&gt; link}  %&gt;
    <span class="err">&lt;</span>% end %&gt;
  <span class="nt">&lt;/ul&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</pre></div>

<p>Just the white background, margins, padding and a hint of a shadow and it already looks better.</p>

<p><a href="./course bookmark_manager.md at master · makersacademy course_files/68747470733a2f2f646368746d36723437316d75692e636c6f756466726f6e742e6e65742f6861636b7061642e636f6d5f48726d4c72614a636c6c795f702e35323536375f313338303230363837333631395f53637265656e25323053686f74253230323031332d30392d3236253230617425323031352e34372e34352e706" target="_blank"><img src="./course bookmark_manager.md at master · makersacademy course_files/68747470733a2f2f646368746d36723437316d75692e636c6f756466726f6e742e6e65742f6861636b7061642e636f6d5f48726d4c72614a636c6c795f702e35323536375f313338303230363837333631395f53637265656e25323053686f74253230323031332d30392d3236253230617425323031352e34372e34352e706" alt="alt text" data-canonical-src="https://dchtm6r471mui.cloudfront.net/hackpad.com_HrmLraJclly_p.52567_1380206873619_Screen%20Shot%202013-09-26%20at%2015.47.45.png" style="max-width:100%;"></a></p>

<p>Now let's make the links look better. First, let's create the elements we want to see in the link partial: title, description, time and author. We don't have most of the information yet, so let's use placeholders for now.</p>

<div class="highlight highlight-html"><pre><span class="nt">&lt;li</span> <span class="na">class=</span><span class="s">'link'</span><span class="nt">&gt;</span>
  <span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">'title'</span> <span class="na">href=</span><span class="s">"&lt;%= link.url %&gt;"</span><span class="nt">&gt;</span><span class="err">&lt;</span>%= link.title %&gt;<span class="nt">&lt;/a&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">'description'</span><span class="nt">&gt;</span>
    Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.
  <span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">'source'</span><span class="nt">&gt;</span>
    added yesterday by
    <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"#"</span><span class="nt">&gt;</span>evgeny@makersacademy.com<span class="nt">&lt;/a&gt;</span>
  <span class="nt">&lt;/span&gt;</span>
<span class="nt">&lt;/li&gt;</span>
</pre></div>

<p>Note that we only use classes in this partial. Since this partial is going to be repeated several times on the page, we can't use any ids because every id is meant to be unique on the page.</p>

<p>Most of the css for this partial is here.</p>

<div class="highlight highlight-css"><pre><span class="nc">.link</span> <span class="p">{</span>
  <span class="k">background-color</span><span class="o">:</span> <span class="m">#EEE</span><span class="p">;</span> <span class="c">/* same as #EEEEEE */</span>
  <span class="n">box</span><span class="o">-</span><span class="n">shadow</span><span class="o">:</span> <span class="m">0</span> <span class="m">0</span> <span class="m">5px</span> <span class="n">rgba</span><span class="p">(</span><span class="m">0</span><span class="o">,</span><span class="m">0</span><span class="o">,</span><span class="m">0</span><span class="o">,</span><span class="m">0</span><span class="o">.</span><span class="m">4</span><span class="p">);</span>
  <span class="c">/* 10px for top and bottom, inherit from parent */</span>
  <span class="c">/* for left and right */</span>
  <span class="k">margin</span><span class="o">:</span> <span class="m">10px</span> <span class="k">inherit</span><span class="p">;</span>
  <span class="k">padding</span><span class="o">:</span> <span class="m">15px</span> <span class="m">10px</span><span class="p">;</span>
<span class="p">}</span>

  <span class="nc">.link</span> <span class="nt">a</span><span class="nc">.title</span> <span class="p">{</span>
    <span class="c">/* to make it slightly more prominent */</span>
    <span class="k">letter-spacing</span><span class="o">:</span> <span class="m">1px</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="nc">.link</span> <span class="nc">.description</span> <span class="p">{</span>
    <span class="k">margin</span><span class="o">:</span> <span class="m">10px</span> <span class="k">inherit</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="nc">.link</span> <span class="nc">.source</span> <span class="p">{</span>
    <span class="c">/* http://learnlayout.com/float.html and the next 4 sections */</span>
    <span class="k">float</span><span class="o">:</span> <span class="k">right</span><span class="p">;</span>
    <span class="k">font-size</span><span class="o">:</span> <span class="m">12px</span><span class="p">;</span>
  <span class="p">}</span>
</pre></div>

<p>Now our frontpage looks much better.</p>

<p><a href="./course bookmark_manager.md at master · makersacademy course_files/68747470733a2f2f646368746d36723437316d75692e636c6f756466726f6e742e6e65742f6861636b7061642e636f6d5f48726d4c72614a636c6c795f702e35323536375f313338303230383836393730315f53637265656e25323053686f74253230323031332d30392d3236253230617425323031362e32312e30332e706" target="_blank"><img src="./course bookmark_manager.md at master · makersacademy course_files/68747470733a2f2f646368746d36723437316d75692e636c6f756466726f6e742e6e65742f6861636b7061642e636f6d5f48726d4c72614a636c6c795f702e35323536375f313338303230383836393730315f53637265656e25323053686f74253230323031332d30392d3236253230617425323031362e32312e30332e706" alt="alt text" data-canonical-src="https://dchtm6r471mui.cloudfront.net/hackpad.com_HrmLraJclly_p.52567_1380208869701_Screen%20Shot%202013-09-26%20at%2016.21.03.png" style="max-width:100%;"></a></p>

<p>Note how the use of shadows gives the page depth.</p>

<p>github
<a href="https://github.com/makersacademy/bookmark_manager/tree/2aac0e5a09c8a1f2bbaad5eecf774eb0c9494211">https://github.com/makersacademy/bookmark_manager/tree/2aac0e5a09c8a1f2bbaad5eecf774eb0c9494211</a></p>

<p>Now let's add a footer to the page to give it completeness (and include a reference to Makers Academy in case this bookmark manager becomes really popular).</p>

<div class="highlight highlight-html"><pre><span class="nt">&lt;footer&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"makersacademy-logo"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"http://www.makersacademy.com/"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;img</span> <span class="na">src=</span><span class="s">"http://www.makersacademy.com/images/logo.png"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;/a&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"technologies"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;p&gt;</span>
      I built this page at
      <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"http://www.makersacademy.com"</span><span class="nt">&gt;</span>Makers Academy,
      a highly selective 12 week coding course in London<span class="nt">&lt;/a&gt;</span>.
    <span class="nt">&lt;/p&gt;</span>
    <span class="nt">&lt;p&gt;</span>
      This website is built using Ruby, Sinatra,
      RSpec, Capybara, HTML and CSS.
    <span class="nt">&lt;/p&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/footer&gt;</span>
</pre></div>

<p>Let's style it using display="flex", as we've done in the header.</p>

<div class="highlight highlight-css"><pre><span class="nt">footer</span> <span class="p">{</span>
  <span class="k">display</span><span class="o">:</span> <span class="n">flex</span><span class="p">;</span>
  <span class="k">background-color</span><span class="o">:</span> <span class="n">rgba</span><span class="p">(</span><span class="m">0</span><span class="o">,</span><span class="m">0</span><span class="o">,</span><span class="m">0</span><span class="o">,</span><span class="m">0</span><span class="o">.</span><span class="m">2</span><span class="p">);</span>
<span class="p">}</span>

  <span class="nt">footer</span> <span class="o">&gt;</span> <span class="o">*</span> <span class="p">{</span>
    <span class="k">margin</span><span class="o">:</span> <span class="k">auto</span> <span class="k">inherit</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="nt">footer</span> <span class="nt">img</span> <span class="p">{</span>
    <span class="c">/* http://stackoverflow.com/questions/10658475/3px-extra-height-on-a-div-with-an-image-inside-it */</span>
    <span class="k">vertical-align</span><span class="o">:</span> <span class="k">top</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="nt">footer</span> <span class="nf">#technologies</span> <span class="p">{</span>
    <span class="o">-</span><span class="n">webkit</span><span class="o">-</span><span class="n">flex</span><span class="o">:</span> <span class="m">1</span><span class="p">;</span>
    <span class="n">flex</span><span class="o">:</span> <span class="m">1</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="nt">footer</span> <span class="nt">p</span> <span class="p">{</span>
    <span class="k">padding</span><span class="o">:</span> <span class="m">5px</span> <span class="m">25px</span><span class="p">;</span>
  <span class="p">}</span>
</pre></div>

<p>This produces the following effect.</p>

<p><a href="./course bookmark_manager.md at master · makersacademy course_files/68747470733a2f2f646368746d36723437316d75692e636c6f756466726f6e742e6e65742f6861636b7061642e636f6d5f48726d4c72614a636c6c795f702e35323536375f313338303231363934343433375f53637265656e25323053686f74253230323031332d30392d3236253230617425323031382e33332e31352e706" target="_blank"><img src="./course bookmark_manager.md at master · makersacademy course_files/68747470733a2f2f646368746d36723437316d75692e636c6f756466726f6e742e6e65742f6861636b7061642e636f6d5f48726d4c72614a636c6c795f702e35323536375f313338303231363934343433375f53637265656e25323053686f74253230323031332d30392d3236253230617425323031382e33332e31352e706" alt="alt text" data-canonical-src="https://dchtm6r471mui.cloudfront.net/hackpad.com_HrmLraJclly_p.52567_1380216944437_Screen%20Shot%202013-09-26%20at%2018.33.15.png" style="max-width:100%;"></a></p>

<p>The footer is not "sticky", that is, if the window is larger than the content available, then the footer will not be at the bottom of the page.</p>

<p><a href="./course bookmark_manager.md at master · makersacademy course_files/68747470733a2f2f646368746d36723437316d75692e636c6f756466726f6e742e6e65742f6861636b7061642e636f6d5f48726d4c72614a636c6c795f702e35323536375f313338303231373130333030355f53637265656e25323053686f74253230323031332d30392d3236253230617425323031382e33382e31352e706" target="_blank"><img src="./course bookmark_manager.md at master · makersacademy course_files/68747470733a2f2f646368746d36723437316d75692e636c6f756466726f6e742e6e65742f6861636b7061642e636f6d5f48726d4c72614a636c6c795f702e35323536375f313338303231373130333030355f53637265656e25323053686f74253230323031332d30392d3236253230617425323031382e33382e31352e706" alt="alt text" data-canonical-src="https://dchtm6r471mui.cloudfront.net/hackpad.com_HrmLraJclly_p.52567_1380217103005_Screen%20Shot%202013-09-26%20at%2018.38.15.png" style="max-width:100%;"></a></p>

<p>There are various techniques of making the footer "sticky". Feel free to try this one.</p>

<p>github
<a href="https://github.com/makersacademy/bookmark_manager/tree/27a54fced01e6c140d9040340c11e12709c57635">https://github.com/makersacademy/bookmark_manager/tree/27a54fced01e6c140d9040340c11e12709c57635</a></p>

<p>Let's now get back to the header and write some CSS for the case when the user is logged in because right now it's not very pretty.</p>

<p><a href="./course bookmark_manager.md at master · makersacademy course_files/68747470733a2f2f646368746d36723437316d75692e636c6f756466726f6e742e6e65742f6861636b7061642e636f6d5f48726d4c72614a636c6c795f702e35323536375f313338303231373439353033355f53637265656e25323053686f74253230323031332d30392d3236253230617425323031382e34342e30372e706" target="_blank"><img src="./course bookmark_manager.md at master · makersacademy course_files/68747470733a2f2f646368746d36723437316d75692e636c6f756466726f6e742e6e65742f6861636b7061642e636f6d5f48726d4c72614a636c6c795f702e35323536375f313338303231373439353033355f53637265656e25323053686f74253230323031332d30392d3236253230617425323031382e34342e30372e706" alt="alt text" data-canonical-src="https://dchtm6r471mui.cloudfront.net/hackpad.com_HrmLraJclly_p.52567_1380217495035_Screen%20Shot%202013-09-26%20at%2018.44.07.png" style="max-width:100%;"></a></p>

<p>The first step would be to give all children of #user-links the display: inline-block property. The second step would be to replace the default button with a beautiful button. Just add the class "button" and update the CSS because right now all relevant CSS declarations only apply to links with the class button, whereas we have an input element in the form. Also, we'll need to explicitely set font-size: 16px for the "button" class.</p>

<p>However, we've just got an unexpected problem. Because the box model for a link and an input element differ, setting the width of 80px for the button class produces different results. A good solution would be to set the same box model rules for all elements, as we discussed in HTML &amp; CSS. We should have done it at the very beginning but it's not too late to change the rules. Let's set it now:</p>

<div class="highlight highlight-css"><pre><span class="o">*</span> <span class="p">{</span>
  <span class="n">box</span><span class="o">-</span><span class="n">sizing</span><span class="o">:</span> <span class="k">border</span><span class="o">-</span><span class="n">box</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

<p>Now the same box model is used for all elements. Since now the width property takes into account borders and padding, we'll need to increase it for the button class.</p>

<div class="highlight highlight-css"><pre><span class="nt">width</span><span class="o">:</span> <span class="nt">110px</span><span class="o">;</span>
</pre></div>

<p>This finally produces a nice result: the input element looks exactly like a button.</p>

<p><a href="./course bookmark_manager.md at master · makersacademy course_files/68747470733a2f2f646368746d36723437316d75692e636c6f756466726f6e742e6e65742f6861636b7061642e636f6d5f48726d4c72614a636c6c795f702e35323536375f313338303231383539393337375f53637265656e25323053686f74253230323031332d30392d3236253230617425323031392e30322e35312e706" target="_blank"><img src="./course bookmark_manager.md at master · makersacademy course_files/68747470733a2f2f646368746d36723437316d75692e636c6f756466726f6e742e6e65742f6861636b7061642e636f6d5f48726d4c72614a636c6c795f702e35323536375f313338303231383539393337375f53637265656e25323053686f74253230323031332d30392d3236253230617425323031392e30322e35312e706" alt="alt text" data-canonical-src="https://dchtm6r471mui.cloudfront.net/hackpad.com_HrmLraJclly_p.52567_1380218599377_Screen%20Shot%202013-09-26%20at%2019.02.51.png" style="max-width:100%;"></a></p>

<p>One last change to the header, though. When you hover over links, the cursor looks like a hand, whereas if you hover over an input element, it looks like an arrow. It's easy to fix by forcing the cursor we need for the button class.</p>

<div class="highlight highlight-css"><pre><span class="nt">cursor</span><span class="o">:</span> <span class="nt">pointer</span><span class="o">;</span> <span class="c">/* pointer looks like a hand */</span>
</pre></div>

<p>github
<a href="https://github.com/makersacademy/bookmark_manager/tree/9c854827b174fa962a5c06df70bf8234c2bc81d3">https://github.com/makersacademy/bookmark_manager/tree/9c854827b174fa962a5c06df70bf8234c2bc81d3</a></p>

<p>Finally, let's style the flash message. At the moment it's not styled at all, it just appears as text:</p>

<p><a href="./course bookmark_manager.md at master · makersacademy course_files/68747470733a2f2f646368746d36723437316d75692e636c6f756466726f6e742e6e65742f6861636b7061642e636f6d5f48726d4c72614a636c6c795f702e35323536375f313338303231393030323435345f53637265656e25323053686f74253230323031332d30392d3236253230617425323031392e30392e35372e706" target="_blank"><img src="./course bookmark_manager.md at master · makersacademy course_files/68747470733a2f2f646368746d36723437316d75692e636c6f756466726f6e742e6e65742f6861636b7061642e636f6d5f48726d4c72614a636c6c795f702e35323536375f313338303231393030323435345f53637265656e25323053686f74253230323031332d30392d3236253230617425323031392e30392e35372e706" alt="alt text" data-canonical-src="https://dchtm6r471mui.cloudfront.net/hackpad.com_HrmLraJclly_p.52567_1380219002454_Screen%20Shot%202013-09-26%20at%2019.09.57.png" style="max-width:100%;"></a></p>

<p>Let's make it beatiful. A few trivial changes produce a better flash notice.</p>

<div class="highlight highlight-css"><pre><span class="nf">#notice</span> <span class="p">{</span>
  <span class="k">text-align</span><span class="o">:</span> <span class="k">center</span><span class="p">;</span>
  <span class="k">margin</span><span class="o">:</span> <span class="m">5px</span><span class="p">;</span>
  <span class="k">padding</span><span class="o">:</span> <span class="m">5px</span><span class="p">;</span>
  <span class="k">background-color</span><span class="o">:</span> <span class="n">rgba</span><span class="p">(</span><span class="m">67</span><span class="o">,</span><span class="m">183</span><span class="o">,</span><span class="m">120</span><span class="o">,</span><span class="m">0</span><span class="o">.</span><span class="m">75</span><span class="p">);</span>
  <span class="k">border</span><span class="o">-</span><span class="n">radius</span><span class="o">:</span> <span class="m">4px</span><span class="p">;</span>
  <span class="n">box</span><span class="o">-</span><span class="n">shadow</span><span class="o">:</span> <span class="m">0</span> <span class="m">0</span> <span class="m">3px</span> <span class="n">rgba</span><span class="p">(</span><span class="m">0</span><span class="o">,</span><span class="m">0</span><span class="o">,</span><span class="m">0</span><span class="o">,</span><span class="m">0</span><span class="o">.</span><span class="m">4</span><span class="p">);</span>
  <span class="k">color</span><span class="o">:</span> <span class="nb">white</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

<p><a href="./course bookmark_manager.md at master · makersacademy course_files/68747470733a2f2f646368746d36723437316d75692e636c6f756466726f6e742e6e65742f6861636b7061642e636f6d5f48726d4c72614a636c6c795f702e35323536375f313338303231393435383033305f53637265656e25323053686f74253230323031332d30392d3236253230617425323031392e31372e33302e706" target="_blank"><img src="./course bookmark_manager.md at master · makersacademy course_files/68747470733a2f2f646368746d36723437316d75692e636c6f756466726f6e742e6e65742f6861636b7061642e636f6d5f48726d4c72614a636c6c795f702e35323536375f313338303231393435383033305f53637265656e25323053686f74253230323031332d30392d3236253230617425323031392e31372e33302e706" alt="alt text" data-canonical-src="https://dchtm6r471mui.cloudfront.net/hackpad.com_HrmLraJclly_p.52567_1380219458030_Screen%20Shot%202013-09-26%20at%2019.17.30.png" style="max-width:100%;"></a></p>

<p>Now our frontpage looks slightly more sophisticated than when we started (even though a professional designer would not be particularly impressed by what we've done).</p>

<p>github
<a href="https://github.com/makersacademy/bookmark_manager/tree/83af49077d34aa9e1d39673df689ab1daef2d73d">https://github.com/makersacademy/bookmark_manager/tree/83af49077d34aa9e1d39673df689ab1daef2d73d</a></p>

<p>Let's style other pages in the same way. The process is mostly mechanical, so let's highlight only the most interesting points.</p>

<p>Firstly, let's make the #links-container element part of the layout, so that it was the basis of every page. Since it's not a links container anymore, we'll rename it as well. This change will not lead to any change in the way the frontpage looks, so no screenshot here.</p>

<p>github
<a href="https://github.com/makersacademy/bookmark_manager/tree/cc1cbffa1314f36021293376e6eae5404ec1dc8e">https://github.com/makersacademy/bookmark_manager/tree/cc1cbffa1314f36021293376e6eae5404ec1dc8e</a></p>

<p>Now let's make the /links/new view look better. Note that we're using placeholders (text inside the input that disappears on focus) instead of labels.</p>

<div class="highlight highlight-html"><pre><span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">name=</span><span class="s">"url"</span> <span class="na">placeholder=</span><span class="s">"Url"</span><span class="nt">&gt;</span>
</pre></div>

<p><a href="./course bookmark_manager.md at master · makersacademy course_files/68747470733a2f2f646368746d36723437316d75692e636c6f756466726f6e742e6e65742f6861636b7061642e636f6d5f48726d4c72614a636c6c795f702e35323536375f313338303237313838353136385f53637265656e25323053686f74253230323031332d30392d3237253230617425323030392e35312e31372e706" target="_blank"><img src="./course bookmark_manager.md at master · makersacademy course_files/68747470733a2f2f646368746d36723437316d75692e636c6f756466726f6e742e6e65742f6861636b7061642e636f6d5f48726d4c72614a636c6c795f702e35323536375f313338303237313838353136385f53637265656e25323053686f74253230323031332d30392d3237253230617425323030392e35312e31372e706" alt="alt text" data-canonical-src="https://dchtm6r471mui.cloudfront.net/hackpad.com_HrmLraJclly_p.52567_1380271885168_Screen%20Shot%202013-09-27%20at%2009.51.17.png" style="max-width:100%;"></a></p>

<p>github
<a href="https://github.com/makersacademy/bookmark_manager/tree/eb68cf41e0bc204365a142fa3520141574a241a2">https://github.com/makersacademy/bookmark_manager/tree/eb68cf41e0bc204365a142fa3520141574a241a2</a></p>

<p>Let's do the same to the sign up and sign in forms, not forgetting the flash for the form. Since we can potentially show more than one error or notice, let's switch to using classes instead of ids.</p>

<div class="highlight highlight-html"><pre><span class="err">&lt;</span>% if flash[:notice] %&gt;
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">'flash notice'</span><span class="nt">&gt;</span>
    <span class="err">&lt;</span>%= flash[:notice] %&gt;
  <span class="nt">&lt;/div&gt;</span>
<span class="err">&lt;</span>% end %&gt;
<span class="err">&lt;</span>% if flash[:errors] <span class="err">&amp;&amp;</span> !flash[:errors].empty? %&gt;
  <span class="nt">&lt;ul&gt;</span>
    <span class="err">&lt;</span>% flash[:errors].each do |error| %&gt;
      <span class="nt">&lt;li</span> <span class="na">class=</span><span class="s">'flash error'</span><span class="nt">&gt;</span><span class="err">&lt;</span>%= error %&gt;<span class="nt">&lt;/li&gt;</span>
    <span class="err">&lt;</span>% end %&gt;
  <span class="nt">&lt;/ul&gt;</span>
<span class="err">&lt;</span>% end %&gt;
</pre></div>

<p><a href="./course bookmark_manager.md at master · makersacademy course_files/68747470733a2f2f646368746d36723437316d75692e636c6f756466726f6e742e6e65742f6861636b7061642e636f6d5f48726d4c72614a636c6c795f702e35323536375f313338303237353139313938375f53637265656e25323053686f74253230323031332d30392d3237253230617425323031302e33362e32302e706" target="_blank"><img src="./course bookmark_manager.md at master · makersacademy course_files/68747470733a2f2f646368746d36723437316d75692e636c6f756466726f6e742e6e65742f6861636b7061642e636f6d5f48726d4c72614a636c6c795f702e35323536375f313338303237353139313938375f53637265656e25323053686f74253230323031332d30392d3237253230617425323031302e33362e32302e706" alt="alt text" data-canonical-src="https://dchtm6r471mui.cloudfront.net/hackpad.com_HrmLraJclly_p.52567_1380275191987_Screen%20Shot%202013-09-27%20at%2010.36.20.png" style="max-width:100%;"></a></p>

<p><a href="./course bookmark_manager.md at master · makersacademy course_files/68747470733a2f2f646368746d36723437316d75692e636c6f756466726f6e742e6e65742f6861636b7061642e636f6d5f48726d4c72614a636c6c795f702e35323536375f313338303237353139363339375f53637265656e25323053686f74253230323031332d30392d3237253230617425323031302e34362e31372e706" target="_blank"><img src="./course bookmark_manager.md at master · makersacademy course_files/68747470733a2f2f646368746d36723437316d75692e636c6f756466726f6e742e6e65742f6861636b7061642e636f6d5f48726d4c72614a636c6c795f702e35323536375f313338303237353139363339375f53637265656e25323053686f74253230323031332d30392d3237253230617425323031302e34362e31372e706" alt="alt text" data-canonical-src="https://dchtm6r471mui.cloudfront.net/hackpad.com_HrmLraJclly_p.52567_1380275196397_Screen%20Shot%202013-09-27%20at%2010.46.17.png" style="max-width:100%;"></a></p>

<p>github
<a href="https://github.com/makersacademy/bookmark_manager/tree/0a78ed38cc17b197fc91ee999ab14a4a72090045">https://github.com/makersacademy/bookmark_manager/tree/0a78ed38cc17b197fc91ee999ab14a4a72090045</a></p>

<p>Now let's make the footer sticky using the technique described by Ryan Fait. One aspect of this technique is that it requires the footer to have a fixed height, so let's fix it at 70px (the height of the image and reduce the font-size to 12px. This will produce a weird side-effect on narrow screens (try resizing the window) but let's learn how to deal with it later, when we'll be discussing responsive design.</p>

<p>By applying Ryan's CSS directly, we achieve the desired effect with minimal changes to our layout.</p>

<div class="highlight highlight-html"><pre><span class="nt">&lt;body&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"wrapper"</span><span class="nt">&gt;</span>
    <span class="err">&lt;</span>%= partial :header %&gt;
    <span class="err">&lt;</span>%= partial :flash %&gt;
    <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">'container'</span><span class="nt">&gt;</span>
      <span class="err">&lt;</span>%= yield %&gt;
    <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"push"</span><span class="nt">&gt;&lt;/div&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"footer"</span><span class="nt">&gt;</span>
    <span class="err">&lt;</span>%= partial :footer %&gt;
  <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/body&gt;</span>
</pre></div>

<p><a href="./course bookmark_manager.md at master · makersacademy course_files/68747470733a2f2f646368746d36723437316d75692e636c6f756466726f6e742e6e65742f6861636b7061642e636f6d5f48726d4c72614a636c6c795f702e35323536375f313338303237363337373331385f53637265656e25323053686f74253230323031332d30392d3237253230617425323031312e30362e31322e706" target="_blank"><img src="./course bookmark_manager.md at master · makersacademy course_files/68747470733a2f2f646368746d36723437316d75692e636c6f756466726f6e742e6e65742f6861636b7061642e636f6d5f48726d4c72614a636c6c795f702e35323536375f313338303237363337373331385f53637265656e25323053686f74253230323031332d30392d3237253230617425323031312e30362e31322e706" alt="alt text" data-canonical-src="https://dchtm6r471mui.cloudfront.net/hackpad.com_HrmLraJclly_p.52567_1380276377318_Screen%20Shot%202013-09-27%20at%2011.06.12.png" style="max-width:100%;"></a></p>

<p>github
<a href="https://github.com/makersacademy/bookmark_manager/tree/10f47e97815b73dc0d75dcbb4eb9a79686f9576f">https://github.com/makersacademy/bookmark_manager/tree/10f47e97815b73dc0d75dcbb4eb9a79686f9576f</a></p>

<p>We will add more advanced functionality using Javascript and more advanced HTML&amp;CSS techniques next week. If you haven't done so yet, it's a good time to deploy your website to Heroku.</p>

<h2>
<a name="user-content-exercises" class="anchor" href="https://github.com/makersacademy/course/blob/master/bookmark_manager.md#exercises" aria-hidden="true"><span class="octicon octicon-link"></span></a>Exercises</h2>

<p>By now you should be able to do all of the following (in no particular order).</p>

<ul class="task-list">
<li>Show the list of available tags on the homepage</li>
<li>Move the form to add a link to its own route</li>
<li>Add user_id to tags and links. Display who the link was submitted by. Same for a tag</li>
<li>Allow the user to add a link to favourites (this will be a many-to-many relationship)</li>
<li>Display how many users favourited the link</li>
<li>Create a user profile page that will show the links they submitted, tags they created and their favourites.</li>
<li>Display the link to the user's profile at the top of the page if the user is logged in</li>
<li>Implement forgotten password functionality</li>
<li>Redirect the user with a flash message if a logged in user tries to sign up or sign in</li>
<li>Send a welcome email when the user signs up</li>
<li>Create validations for all models:</li>
<li>email must have the correct format (see an example in Datamapper Validations)</li>
<li>email and password must be present</li>
<li>link must have a title and a url</li>
<li>tag must have some text</li>
<li>Add a description property to the link.</li>
<li>Add a username to the User model, so that username instead of an email was shown next to the link.</li>
</ul></article>
  </div>

  </div>
</div>

<a href="https://github.com/makersacademy/course/blob/master/bookmark_manager.md#jump-to-line" rel="facebox[.linejump]" data-hotkey="l" style="display:none">Jump to Line</a>
<div id="jump-to-line" style="display:none">
  <form accept-charset="UTF-8" class="js-jump-to-line-form">
    <input class="linejump-input js-jump-to-line-field" type="text" placeholder="Jump to line…" autofocus="">
    <button type="submit" class="button">Go</button>
  </form>
</div>

        </div>

      </div><!-- /.repo-container -->
      <div class="modal-backdrop"></div>
    </div><!-- /.container -->
  </div><!-- /.site -->


    </div><!-- /.wrapper -->

      <div class="container">
  <div class="site-footer" role="contentinfo">
    <ul class="site-footer-links right">
      <li><a href="https://status.github.com/">Status</a></li>
      <li><a href="http://developer.github.com/">API</a></li>
      <li><a href="http://training.github.com/">Training</a></li>
      <li><a href="http://shop.github.com/">Shop</a></li>
      <li><a href="https://github.com/blog">Blog</a></li>
      <li><a href="https://github.com/about">About</a></li>

    </ul>

    <a href="https://github.com/" aria-label="Homepage">
      <span class="mega-octicon octicon-mark-github" title="GitHub"></span>
    </a>

    <ul class="site-footer-links">
      <li>© 2014 <span title="0.06481s from github-fe130-cp1-prd.iad.github.net">GitHub</span>, Inc.</li>
        <li><a href="https://github.com/site/terms">Terms</a></li>
        <li><a href="https://github.com/site/privacy">Privacy</a></li>
        <li><a href="https://github.com/security">Security</a></li>
        <li><a href="https://github.com/contact">Contact</a></li>
    </ul>
  </div><!-- /.site-footer -->
</div><!-- /.container -->


    <div class="fullscreen-overlay js-fullscreen-overlay" id="fullscreen_overlay">
  <div class="fullscreen-container js-suggester-container">
    <div class="textarea-wrap">
      <textarea name="fullscreen-contents" id="fullscreen-contents" class="fullscreen-contents js-fullscreen-contents js-suggester-field" placeholder=""></textarea>
    </div>
  </div>
  <div class="fullscreen-sidebar">
    <a href="https://github.com/makersacademy/course/blob/master/bookmark_manager.md#" class="exit-fullscreen js-exit-fullscreen tooltipped tooltipped-w" aria-label="Exit Zen Mode">
      <span class="mega-octicon octicon-screen-normal"></span>
    </a>
    <a href="https://github.com/makersacademy/course/blob/master/bookmark_manager.md#" class="theme-switcher js-theme-switcher tooltipped tooltipped-w" aria-label="Switch themes">
      <span class="octicon octicon-color-mode"></span>
    </a>
  </div>
</div>



    <div id="ajax-error-message" class="flash flash-error">
      <span class="octicon octicon-alert"></span>
      <a href="https://github.com/makersacademy/course/blob/master/bookmark_manager.md#" class="octicon octicon-x flash-close js-ajax-error-dismiss" aria-label="Dismiss error"></a>
      Something went wrong with that request. Please try again.
    </div>


      <script crossorigin="anonymous" src="./course bookmark_manager.md at master · makersacademy course_files/frameworks-a01bdc1aca276a761ef0fa0428e86678b940285a.js" type="text/javascript"></script>
      <script async="async" crossorigin="anonymous" src="./course bookmark_manager.md at master · makersacademy course_files/github-1030fc9b11a7a959def8e71b7279f099ffd53f83.js" type="text/javascript"></script>
      
      
        <script async="" src="./course bookmark_manager.md at master · makersacademy course_files/analytics.js"></script>
  


<div id="global-zeroclipboard-html-bridge" class="global-zeroclipboard-container" style="position: absolute; left: 0px; top: -9999px; width: 1px; height: 1px; z-index: 999999999;"><object id="global-zeroclipboard-flash-bridge" name="global-zeroclipboard-flash-bridge" width="100%" height="100%" type="application/x-shockwave-flash" data="https://assets-cdn.github.com/flash/ZeroClipboard.v2.1.6.swf"><param name="allowScriptAccess" value="always"><param name="allowNetworking" value="all"><param name="menu" value="false"><param name="wmode" value="transparent"><param name="flashvars" value="trustedOrigins=github.com%2C%2F%2Fgithub.com%2Chttps%3A%2F%2Fgithub.com&amp;swfObjectId=global-zeroclipboard-flash-bridge"></object></div>    <div class="facebox" id="facebox" style="display:none;">       <div class="facebox-popup">         <div class="facebox-content">         </div>         <button type="button" class="facebox-close js-facebox-close" aria-label="Close modal">           <span class="octicon octicon-remove-close"></span>         </button>       </div>     </div></body></html>